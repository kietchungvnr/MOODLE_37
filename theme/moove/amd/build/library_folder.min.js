define(["jquery","core/config","core/str","core/notification"],function(e,a,t,r){"use strict";var o="/local/newsvnr/ajax/library_folder_ajax.php",l="/local/newsvnr/ajax/library_module_ajax.php";e("#add-new-folder").click(function(){var a=e(".add-folder-popup #foldername").val(),t=e(".add-folder-popup #folderparent").attr("parentid"),r=e(".add-folder-popup #folderdes").val(),l=e(this).attr("forderid"),i=e(this).attr("action");if(""!=a){var d={type:"GET",processData:!0,data:{foldername:a,folderid:l,parentid:t,folderdes:r,action:i},contenttype:"application/json"};e.ajax(o,d).then(function(a){e("#add-popup-modal-folder").modal("hide");var t=e.parseJSON(a);alertSuccess(t.alert),location.reload()})}else alert("Tên thư mục không được để trống")}),e(".tree-folder .folder").bind("contextmenu",function(a){e(".tree-folder .folder").removeClass("active"),e(this).toggleClass("active");var t=a.clientX;a.preventDefault();var r=e(this).attr("id"),o=e(this).text(),l=e(".popup-setting"),i=e(this).position();e(".popup-setting li").attr("folderid",r),e(".popup-setting li").attr("foldername",o),l.css("top",i.top+5),l.css("left",t-35),l.show()}),e("body").click(function(){e(".popup-setting").hide()}),e(".popup-setting li").click(function(){var a=e(this).attr("folderid"),t=e(this).attr("action"),r=e(this).attr("foldername");if("delete"==t&&0==confirm("Bạn có chắc muốn xóa , sẽ bị mất hết dữ liệu!"))return;if("addchildfolder"!=t){var l={type:"GET",processData:!0,data:{folderid:a,action:t},contenttype:"application/json"};e.ajax(o,l).then(function(r){var o=e.parseJSON(r);"delete"==t?(e("li.folder#"+a).remove(),alertSuccess(o.alert)):(e("#edit-popup-modal-folder").replaceWith(o.result),e("#edit-popup-modal-folder").modal("show"))})}else e("#add-popup-modal-folder").on("shown.bs.modal",function(t){e("input#folderparent").val(r),e("input#folderparent").attr("parentid",a)})}),e("#add-popup-modal-folder").on("show.bs.modal",function(){e("#add-popup-modal-folder input#foldername").val(""),e("#tree-view-folder").slideUp(),e("#add-popup-modal-folder textarea#folderdes").val("")}),e("#folder_library li.folder").click(function(){e(".alert-warning").text(""),e(".alert-warning").removeClass("alert"),e(".loading-page").addClass("active"),e("#folder_library li.folder").removeClass("active"),e(this).addClass("active");var a=e(this).attr("id");e('.add-module-popup input[name="selectmodule"]').attr("folderid",a),e("#searchlibrary").attr("folderid",a),e('button[data-target="#add-popup-modal-module"]').show();var t={type:"GET",processData:!0,data:{folderid:a},contenttype:"application/json"};e.ajax(l,t).then(function(a){var t=e.parseJSON(a);console.log(t.result),e("#table-library").hide().html(t.result).fadeIn("fast"),e("#header-library").replaceWith(t.header),e("#pagination").replaceWith(t.pagination),e(".loading-page").removeClass("active"),""==t.result&&e(".alert-warning").replaceWith(t.alert)})}),e("#add-new-module").click(function(){var a=e('.add-module-popup input[name="selectmodule"]:checked').val(),t=e('.add-module-popup input[name="selectmodule"]:checked').attr("folderid");window.location.href="course/modedit.php?add="+a+"&type=&course=1&section=1&return=0&sr=&folderid="+t});var i=a.wwwroot+"/library.php";window.location.href==i&&e.getJSON("/local/newsvnr/ajax/library_module_ajax.php",function(a){e("#table-library").hide().html(a.result).fadeIn("fast")}),e("i.library").click(function(){var a={type:"GET",processData:!0,data:{folderid:e("#searchlibrary").attr("folderid"),search:e("#searchlibrary").val().trim()},contenttype:"application/json"};e.ajax(l,a).then(function(a){var t=e.parseJSON(a);e("#table-library tr").remove(),e("#table-library").append(t.result),e("#header-library").replaceWith(t.header),e("#pagination").replaceWith(t.pagination)})}),e("#searchlibrary").keypress(function(a){13==event.which&&e("i.library").click()}),e("#searchlibrary").keyup(function(a){var t=e("#searchlibrary").val().trim();8==a.keyCode&&""==t&&e("i.library").click()})});