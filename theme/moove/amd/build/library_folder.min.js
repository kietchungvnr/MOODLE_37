define(["jquery","core/config","core/str","core/notification","alertjs"],function(a,e,t,r,l){"use strict";var o="/local/newsvnr/ajax/library_online/library_folder_ajax.php",i="/local/newsvnr/ajax/library_online/library_module_ajax.php";t.get_strings([{key:"alert",component:"local_newsvnr"},{key:"confirmdeletefolder",component:"local_newsvnr"},{key:"confirmfoldername",component:"local_newsvnr"}]).then(function(t){a("#add-new-folder").click(function(){var e=a(".add-folder-popup #foldername").val(),r=a(".add-folder-popup #folderparent").attr("parentid"),i=a(".add-folder-popup #folderdes").val(),n={type:"GET",processData:!0,data:{foldername:e,folderid:a(this).attr("forderid"),parentid:r,folderdes:i,action:a(this).attr("action")},contenttype:"application/json"};""!=e?a.ajax(o,n).then(function(e){a("#add-popup-modal-folder").modal("hide");var t=a.parseJSON(e);l.notify(t.alert,"success",3),location.reload()}):l.alert(t[0],t[2])}),a(".tree-folder .folder").bind("contextmenu",function(e){if(a(".popup-setting").hide(),a(this).hasClass("show"))var t=1;else t=0;var r={type:"POST",processData:!0,data:{visible:t,action:"popupsetting",allmodule:a(this).attr("allmodule"),folderid:a(this).attr("id"),foldername:a(this).text()},contenttype:"application/json"};a(".tree-folder .folder").removeClass("active"),a(this).toggleClass("active");var l=e.clientX;e.preventDefault();a(this).attr("id"),a(this).text();var i=a(".popup-setting"),n=a(this).position();i.css("top",n.top+5),i.css("left",l-35),a.ajax(o,r).then(function(e){var t=a.parseJSON(e);a.when(a(".popup-setting ul").replaceWith(t.setting)).then(i.show())})}),a("body").click(function(){a(".popup-setting").hide()}),a("#add-popup-modal-folder").on("show.bs.modal",function(){a("#add-popup-modal-folder input#foldername").val(""),a(".tree-view-folder").slideUp(),a("#add-popup-modal-folder textarea#folderdes").val("")}),a("#folder_library li.folder").click(function(){a(".alert-warning").text(""),a(".alert-warning").removeClass("alert"),a(".loading-page").addClass("active"),a("#folder_library li.folder").removeClass("active"),a("#folder_library li.folder").addClass("not-allow"),a(this).addClass("active");var e=a(this).attr("id");a('.add-module-popup input[name="selectmodule"]').attr("folderid",e),a("#searchlibrary").attr("folderid",e),a('button[data-target="#add-popup-modal-module"]').show();var t={type:"GET",processData:!0,data:{folderid:e},contenttype:"application/json"};a.ajax(i,t).then(function(e){var t=a.parseJSON(e);a("#table-library").hide().html(t.result).fadeIn("fast"),a("#header-library").replaceWith(t.header),a("#pagination").replaceWith(t.pagination),a(".loading-page").removeClass("active"),""==t.result&&a(".alert-warning").replaceWith(t.alert),a("#folder_library li.folder").removeClass("not-allow")})}),a("#add-new-module").click(function(){var e=a('.add-module-popup input[name="selectmodule"]:checked').val(),t=a('.add-module-popup input[name="selectmodule"]:checked').attr("folderid");window.location.href="course/modedit.php?add="+e+"&type=&course=1&section=1&return=0&sr=&folderid="+t});var r=e.wwwroot+"/library.php";function n(e){for(var t=a(e).getKendoGrid(),r=t.select(),l=[],o=0;o<r.length;o++)l.push(t.dataItem(r[o]));return l}window.location.href==r&&a.getJSON(i,function(e){a("#table-library").hide().html(e.result).fadeIn("fast"),a("#header-library").replaceWith(e.header),a("#pagination").replaceWith(e.pagination)}),a("i.library").click(function(){var e={type:"GET",processData:!0,data:{folderid:a("#searchlibrary").attr("folderid"),search:a("#searchlibrary").val().trim(),searchtype:a("#searchlibrary").attr("searchtype")},contenttype:"application/json"};a.ajax(i,e).then(function(e){var t=a.parseJSON(e);a("#table-library tr").remove(),a("#table-library").append(t.result),a("#header-library").replaceWith(t.header),a("#pagination").replaceWith(t.pagination),a(".alert-warning").replaceWith(t.alert)})}),a("#searchlibrary").keypress(function(e){13==event.which&&a("i.library").click()}),a("#searchlibrary").keyup(function(e){var t=a("#searchlibrary").val().trim();8==e.keyCode&&""==t&&a("i.library").click()}),a("li.click-expand").each(function(){var e=a(this).attr("id");a(".content-expand."+e).is(":empty")&&a(this).children("i.rotate-icon").remove()}),a("#filter_search_library").bind("change",function(){var e=a(this).val();a("#searchlibrary").attr("searchtype",e),"searchcontent"==e?a(".k-animation-container").addClass("d-none"):a(".k-animation-container").removeClass("d-none")}),a(".nav.multi-tab li a").click(function(){var e=a(this).attr("data-key");a(".nav.multi-tab li a").removeClass("active"),a(this).addClass("active"),a(".tab-content .tab-pane").hide(),a('.tab-content .tab-pane[data="'+e+'"]').fadeIn("fast")}),a("#delete-module-select").click(function(){var e=n("#library-approval-module"),t={type:"POST",processData:!0,data:{dataselect:JSON.stringify(e)}};a.ajax("/local/newsvnr/ajax/library_online/library_approval_module_ajax.php?action=deleteselect",t).then(function(){a("#library-approval-module").data("kendoGrid").dataSource.read()})}),a("#approval-module-select").click(function(){var e=n("#library-approval-module"),t={type:"POST",processData:!0,data:{dataselect:JSON.stringify(e)}};a.ajax("/local/newsvnr/ajax/library_online/library_approval_module_ajax.php?action=approvalselect",t).then(function(){a("#library-approval-module").data("kendoGrid").dataSource.read()})})})});