define(["jquery","core/config","core/str","core/notification","alertjs","kendo.all.min"],function(e,a,r,t,o,l){"use strict";return{init:function(){var t="/local/newsvnr/ajax/library_online/library_folder_ajax.php",l="/local/newsvnr/ajax/library_online/library_module_ajax.php",i="/local/newsvnr/ajax/library_online/library_share_module.php?action=";r.get_strings([{key:"alert",component:"local_newsvnr"},{key:"confirmdeletefolder",component:"local_newsvnr"},{key:"confirmfoldername",component:"local_newsvnr"}]).then(function(r){e("#add-new-folder").click(function(){e(this).addClass("not-allow");var a=e(".add-folder-popup #foldername").val(),l=e(".add-folder-popup #folderparent").attr("parentid"),i=e(".add-folder-popup #folderdes").val(),n={type:"GET",processData:!0,data:{foldername:a,folderid:e(this).attr("forderid"),parentid:l,folderdes:i,action:e(this).attr("action")},contenttype:"application/json"};""!=a?e.ajax(t,n).then(function(a){var r=e.parseJSON(a);o.notify(r.alert,"success",3),location.reload()}):o.alert(r[0],r[2])}),e(".tree-folder .folder").bind("contextmenu",function(a){if(e(".popup-setting").hide(),e(this).hasClass("show"))var r=1;else r=0;var o={type:"POST",processData:!0,data:{visible:r,action:"popupsetting",allmodule:e(this).attr("allmodule"),folderid:e(this).attr("id"),foldername:e(this).text()},contenttype:"application/json"};e(".tree-folder .folder").removeClass("active"),e(this).toggleClass("active");var l=a.clientX;a.preventDefault(),e(this).attr("id"),e(this).text();var i=e(".popup-setting"),n=e(this).position();i.css("top",n.top+5),i.css("left",l-35),e.ajax(t,o).then(function(a){var r=e.parseJSON(a);e.when(e(".popup-setting ul").replaceWith(r.setting)).then(i.show())})}),e("body").click(function(){e(".popup-setting").hide()}),e("#add-popup-modal-folder").on("show.bs.modal",function(){e("#add-popup-modal-folder input#foldername").val(""),e(".tree-view-folder").slideUp(),e("#add-popup-modal-folder textarea#folderdes").val("")}),e("#folder_library li.folder").click(function(){e(".alert-warning").text(""),e(".alert-warning").removeClass("alert"),e(".loading-page").addClass("active"),e("#folder_library li.folder").removeClass("active"),e("#folder_library li.folder").addClass("not-allow"),e(this).addClass("active");var a=e(this).attr("id");e('.add-module-popup input[name="selectmodule"]').attr("folderid",a),e("#searchlibrary").attr("folderid",a),e('button[data-target="#add-popup-modal-module"]').show();var r={type:"GET",processData:!0,data:{folderid:a},contenttype:"application/json"};e.ajax(l,r).then(function(a){var r=e.parseJSON(a);e("#table-library").hide().html(r.result).fadeIn("fast"),e("#header-library").replaceWith(r.header),e("#pagination").replaceWith(r.pagination),e(".loading-page").removeClass("active"),""==r.result&&e(".alert-warning").replaceWith(r.alert),e("#folder_library li.folder").removeClass("not-allow")})}),e("#add-new-module").click(function(){var a=e('.add-module-popup input[name="selectmodule"]:checked').val(),r=e('.add-module-popup input[name="selectmodule"]:checked').attr("folderid");window.location.href="course/modedit.php?add="+a+"&type=&course=1&section=1&return=0&sr=&folderid="+r});var n=a.wwwroot+"/library.php";function d(a){for(var r=e(a).getKendoGrid(),t=r.select(),o=[],l=0;l<t.length;l++)o.push(r.dataItem(t[l]));return o}window.location.href==n&&e.getJSON(l,function(a){e("#table-library").hide().html(a.result).fadeIn("fast"),e("#header-library").replaceWith(a.header),e("#pagination").replaceWith(a.pagination)}),e("i.library").click(function(){var a={type:"GET",processData:!0,data:{folderid:e("#searchlibrary").attr("folderid"),search:e("#searchlibrary").val().trim(),searchtype:e("#searchlibrary").attr("searchtype")},contenttype:"application/json"};e.ajax(l,a).then(function(a){var r=e.parseJSON(a);e("#table-library tr").remove(),e("#table-library").append(r.result),e("#header-library").replaceWith(r.header),e("#pagination").replaceWith(r.pagination),e(".alert-warning").replaceWith(r.alert)})}),e("#searchlibrary").keypress(function(a){13==event.which&&e("i.library").click()}),e("#searchlibrary").keyup(function(a){var r=e("#searchlibrary").val().trim();8==a.keyCode&&""==r&&e("i.library").click()}),e("li.click-expand").each(function(){var a=e(this).attr("id");e(".content-expand."+a).is(":empty")&&e(this).children("i.rotate-icon").remove()}),e("#filter_search_library").bind("change",function(){var a=e(this).val();e("#searchlibrary").attr("searchtype",a),"searchcontent"==a?e(".k-animation-container").addClass("d-none"):e(".k-animation-container").removeClass("d-none")}),e("#delete-module-select").click(function(){var a=d("#library-approval-module"),r={type:"POST",processData:!0,data:{dataselect:JSON.stringify(a)}};e.ajax("/local/newsvnr/ajax/library_online/library_approval_module_ajax.php?action=deleteselect",r).then(function(){e("#library-approval-module").data("kendoGrid").dataSource.read()})}),e("#approval-module-select").click(function(){var a=d("#library-approval-module"),r={type:"POST",processData:!0,data:{dataselect:JSON.stringify(a)}};e.ajax("/local/newsvnr/ajax/library_online/library_approval_module_ajax.php?action=approvalselect",r).then(function(){e("#library-approval-module").data("kendoGrid").dataSource.read()})}),e("#table-library").on("click","a#share-module-library",function(a){e("#share-popup-modal-module").modal("show");var r=e(this).attr("moduleid");e("#module-from-library").attr("moduleid",r)}),e("#course-share-input").kendoDropDownList({dataTextField:"name",dataValueField:"courseid",autoBind:!1,filter:"contains",dataSource:{transport:{read:{url:i+"filter_course",contentType:"application/json; charset=utf-8",type:"POST",dataType:"json",serverFiltering:!0}}}}),e("#course-section-input").kendoDropDownList({cascadeFrom:"course-share-input",dataTextField:"name",dataValueField:"sectionid",autoBind:!1,filter:"contains",dataSource:{transport:{read:{url:i+"filter_course_section",contentType:"application/json; charset=utf-8",type:"POST",dataType:"json",serverFiltering:!0}}}}),e("#share-module-library").click(function(){var a={type:"GET",processData:!0,dataType:"json",data:{moduleid:e("#module-from-library").attr("moduleid"),courseid:e("#course-share-input").val(),sectionid:e("#course-section-input").val()}};e.ajax(i+"share_module",a).then(function(e){o.notify(e.success,"success",3)})})})}}});