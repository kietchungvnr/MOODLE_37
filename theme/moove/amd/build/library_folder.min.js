define(["jquery","core/config","core/str","core/notification","alertjs","local_newsvnr/initkendogrid","local_newsvnr/initkendocontrolservices"],function(e,a,t,r,i,o,l){"use strict";return{init:function(){var r,n,d;r="/local/newsvnr/ajax/library_online/library_folder_ajax.php",n="/local/newsvnr/ajax/library_online/library_module_ajax.php",d="/local/newsvnr/ajax/library_online/library_share_module.php?action=",t.get_strings([{key:"alert",component:"local_newsvnr"},{key:"confirmdeletefolder",component:"local_newsvnr"},{key:"confirmfoldername",component:"local_newsvnr"}]).then(function(t){e("#add-new-folder").click(function(){var a=e(".add-folder-popup #foldername").val(),t=e(".add-folder-popup .folderparent").attr("parentid"),o=e(".add-folder-popup #folderdes").val(),l=e(this).attr("forderid"),n=e(this).attr("action"),d=e("#positionpermission").data("kendoMultiSelect");if(null!=d)var s=d.value(),c=JSON.stringify(s);else c="";var p={type:"GET",processData:!0,data:{foldername:a,folderid:l,parentid:t,folderdes:o,action:n,listposition:c},contenttype:"application/json"};""!=a?(e(this).addClass("not-allow"),e.ajax(r,p).then(function(a){var t=e.parseJSON(a);i.notify(t.alert,"success",3),location.reload()})):e(".form_input_validate:not(:focus):invalid").css("background-image",'url("theme/moove/pix/notvalid.png")')}),e(".tree-folder .folder").bind("contextmenu",function(a){if(e(".popup-setting").hide(),e(this).hasClass("show"))var t=1;else t=0;var i={type:"POST",processData:!0,data:{visible:t,action:"popupsetting",allmodule:e(this).attr("allmodule"),folderid:e(this).attr("id"),foldername:e(this).text()},contenttype:"application/json"};e(".tree-folder .folder").removeClass("active"),e(this).toggleClass("active");var o=a.clientX;a.preventDefault(),e(this).attr("id"),e(this).text();var l=e(".popup-setting"),n=e(this).position();l.css("top",n.top+5),e("#page-wrapper").hasClass("slide-nav-toggle")?l.css("left",o-256):l.css("left",o-75),e.ajax(r,i).then(function(a){var t=e.parseJSON(a);e.when(e(".popup-setting ul").replaceWith(t.setting)).then(l.show())})}),e("body").click(function(){e(".popup-setting").hide()}),e("#add-popup-modal-folder").on("show.bs.modal",function(){e("#add-popup-modal-folder input#foldername").val(""),e(".tree-view-folder").slideUp(),e("#add-popup-modal-folder textarea#folderdes").val("")}),e("#folder_library a.folder-child").click(function(){e(".alert-warning").text(""),e(".alert-warning").removeClass("alert"),e(".loading-page").addClass("active"),e(".sort-module i").remove(),e("#folder_library li.folder").removeClass("active"),e("#folder_library li.folder").addClass("not-allow"),e(this).parent("li").addClass("active");var a=e(this).attr("id");e('.add-module-popup input[name="selectmodule"]').attr("folderid",a),e(".searchlibrary").attr("folderid",a),e(this).parent("li").hasClass("title")?e('div[data-target="#add-popup-modal-module"]').hide():e('div[data-target="#add-popup-modal-module"]').show();var t={type:"GET",processData:!0,data:{folderid:a},contenttype:"application/json"};e.ajax(n,t).then(function(a){var t=e.parseJSON(a);e("#table-library").hide().html(t.result).fadeIn("fast"),e("#header-library").replaceWith(t.header),e("#pagination").replaceWith(t.pagination),e(".loading-page").removeClass("active"),""==t.result&&e(".alert-warning").replaceWith(t.alert),e("#folder_library li.folder").removeClass("not-allow")})}),e("#add-new-module").click(function(){var a=e('.add-module-popup input[name="selectmodule"]:checked').val(),t=e('.add-module-popup input[name="selectmodule"]:checked').attr("folderid");window.location.href="course/modedit.php?add="+a+"&type=&course=1&section=1&return=0&sr=&folderid="+t});var o=a.wwwroot+"/library.php";function s(a){for(var t=e(a).getKendoGrid(),r=t.select(),i=[],o=0;o<r.length;o++)i.push(t.dataItem(r[o]));return i}window.location.href==o&&e.getJSON(n,function(a){e("#table-library").hide().html(a.result).fadeIn("fast"),e("#header-library").replaceWith(a.header),e("#pagination").replaceWith(a.pagination)}),e("button.library").click(function(){e(".loading-page").addClass("active"),e(".sort-module i").remove();var a={type:"GET",processData:!0,data:{folderid:e(this).prev(".searchlibrary").attr("folderid"),search:e(this).prev(".searchlibrary").val().trim(),searchtype:e(this).prev(".searchlibrary").attr("searchtype")},contenttype:"application/json"};e.ajax(n,a).then(function(a){var t=e.parseJSON(a);e(".loading-page").removeClass("active"),e("#table-library tr").remove(),e("#table-library").append(t.result),e("#header-library").replaceWith(t.header),e("#pagination").replaceWith(t.pagination),e(".alert-warning").replaceWith(t.alert)})}),e(".searchlibrary").keyup(function(a){var t=e(".searchlibrary").val().trim();8==a.keyCode&&""==t&&e(this).next("button.library").click()}),e(".icon-plus").click(function(){var t=e(this).attr("id"),r=a.wwwroot+"/theme/moove/pix/plus.png",i=a.wwwroot+"/theme/moove/pix/minus.png";e(this).attr("src")==r?e(this).attr("src",i):e(this).attr("src",r),e(".content-expand."+t).slideToggle()}),e("#delete-module-select").click(function(){var a=s("#library-approval-module"),t={type:"POST",processData:!0,data:{dataselect:JSON.stringify(a)}};e.ajax("/local/newsvnr/ajax/library_online/library_approval_module_ajax.php?action=deleteselect",t).then(function(){e("#library-approval-module").data("kendoGrid").dataSource.read()})}),e("#approval-module-select").click(function(){var a=s("#library-approval-module"),t={type:"POST",processData:!0,data:{dataselect:JSON.stringify(a)}};e.ajax("/local/newsvnr/ajax/library_online/library_approval_module_ajax.php?action=approvalselect",t).then(function(){e("#library-approval-module").data("kendoGrid").dataSource.read()})}),e("#table-library").on("click","a#share-module-library",function(a){e("#share-popup-modal-module").modal("show");var t=e(this).attr("moduleid");e("#share-module-library").attr("moduleid",t)}),(c={}).apiSettings={url:d+"filter_course"},c.value="courseid";var c,p=l.initDropDownList(c);e("#course-share-input").kendoDropDownList(p),(c={}).apiSettings={url:d+"filter_course_section"},c.value="sectionid",c.cascadeFrom="course-share-input";var u=l.initDropDownList(c);e("#course-section-input").kendoDropDownList(u),e("#share-module-library").click(function(){var a={type:"GET",processData:!0,dataType:"json",data:{moduleid:e("#share-module-library").attr("moduleid"),courseid:e("#course-share-input").val(),sectionid:e("#course-section-input").val()}};e.ajax(d+"share_module",a).then(function(e){i.notify(e.success,"success",3)})}),e(".approvalmodule").click(function(){var a=e("#viewApprovalModule").data("kendoWindow");a.title("Duyệt tài nguyên"),a.center().open()}),e("#viewApprovalModule").kendoWindow({width:"1200px",title:"",visible:!1,open:function(e){setPositionWindow("#viewApprovalModule",100)},actions:["Minimize","Maximize","Close"]}),e("#modal-iframe-library").on("hidden.bs.modal",function(){document.cookie="cookie=; max-Age=-1;path=/"}),e(".sort-module").click(function(){e(".loading-page").addClass("active"),e(".sort-module i").remove();var a=e(this).attr("action"),t=e("#pagination").attr("folderid"),r=e("#pagination").attr("modulefilter"),i=e("#pagination").attr("search");"viewsort_desc"==a&&(e(this).html(M.util.get_string("viewed","local_newsvnr")+'<i class="ml-1 fa fa-arrow-down" aria-hidden="true"></i>'),e(this).attr("action","viewsort_asc")),"viewsort_asc"==a&&(e(this).html(M.util.get_string("viewed","local_newsvnr")+'<i class="ml-1 fa fa-arrow-up" aria-hidden="true"></i>'),e(this).attr("action","viewsort_desc")),"timesort_desc"==a&&(e(this).html('Time created<i class="ml-1 fa fa-arrow-down" aria-hidden="true"></i>'),e(this).attr("action","timesort_asc")),"timesort_asc"==a&&(e(this).html('Time created<i class="ml-1 fa fa-arrow-up" aria-hidden="true"></i>'),e(this).attr("action","timesort_desc"));var o={type:"GET",processData:!0,dataType:"json",data:{folderid:t,modulefilter:r,search:i,action:a}};e.ajax(n,o).then(function(a){e("#table-library").hide().html(a.result).fadeIn("fast"),e(".loading-page").removeClass("active"),e("#pagination").replaceWith(a.pagination)})})}),function(){var t={},r={url:a.wwwroot+"/local/newsvnr/ajax/library_online/library_request_approval.php",type:"GET",dataType:"json",contentType:"application/json; charset=utf-8"};t.onChange=function(){e.map(this.select(),function(a){return e(a).text()}).length>0?e(".request-module-fuction").removeClass("disabled"):e(".request-module-fuction").addClass("disabled")},t.columns=[{template:function(e){return e.name},field:"name",title:"Tên",width:"130px"},{field:"folder",title:"Thư mục",width:"100px"},{field:"moduletype",title:"Loại",width:"80px"},{field:"size",title:"Kích thước",width:"80px"},{template:function(e){return e.download},field:"download",title:"Tải xuống",width:"100px"},{field:"timecreated",title:"Ngày yêu cầu",width:"100px"},{field:"author",title:"Người yêu cầu",width:"120px"},{template:function(e){return e.status},field:"status",title:"Trạng thái",width:"100px"},{template:function(e){return e.action},field:"action",title:"Chức năng",width:"150px"}],t.apiSettings=r;var i=o.initGrid(t);e("#library-request-approval").kendoGrid(i)}(),e("#delete_module_request").click(function(){var t=a.wwwroot+"/local/newsvnr/ajax/library_online/library_approval_module_ajax.php",r=getSelectRow("#library-request-approval"),o={type:"POST",processData:!0,data:{dataselect:JSON.stringify(r),action:"deleteselectrequest"}};i.confirm("Cảnh báo","Bạn có chắc muốn xóa các tài liệu đã chọn?",function(){e.ajax(t,o).then(function(a){var t=e.parseJSON(a);i.notify(t.message,"success",3),e("#library-request-approval").data("kendoGrid").dataSource.read(),e(".request-module-fuction").addClass("disabled")})},function(){})}),e("#request_approval").click(function(){var t=a.wwwroot+"/local/newsvnr/ajax/library_online/library_approval_module_ajax.php",r=getSelectRow("#library-request-approval"),o={type:"POST",processData:!0,data:{dataselect:JSON.stringify(r),action:"requestapprovalselect"}};e.ajax(t,o).then(function(a){var t=e.parseJSON(a);i.notify(t.message,"success",3),e("#library-request-approval").data("kendoGrid").dataSource.read(),e(".request-module-fuction").addClass("disabled")})})}}});