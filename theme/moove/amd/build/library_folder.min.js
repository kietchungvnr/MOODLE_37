define(["jquery","core/config","core/str","core/notification"],function(e,a,r,t){"use strict";var l="/local/newsvnr/ajax/library_folder_ajax.php",o="/local/newsvnr/ajax/library_module_ajax.php";e("#add-new-folder").click(function(){var a=e(".add-folder-popup #foldername").val(),r=e(".add-folder-popup #folderparent").attr("parentid"),t=e(".add-folder-popup #folderdes").val(),o=e(this).attr("forderid"),i=e(this).attr("action");if(""!=a){var d={type:"GET",processData:!0,data:{foldername:a,folderid:o,parentid:r,folderdes:t,action:i},contenttype:"application/json"};e.ajax(l,d).then(function(a){e("#add-popup-modal-folder").modal("hide");var r=e.parseJSON(a);alertSuccess(r.alert),location.reload()})}else alert("Tên thư mục không được để trống")}),e(".tree-folder .folder").bind("contextmenu",function(a){e(".tree-folder .folder").removeClass("active"),e(this).toggleClass("active");var r=a.clientX;a.preventDefault();var t=e(this).attr("id"),l=e(this).text(),o=e(".popup-setting"),i=e(this).position();e(".popup-setting li").attr("folderid",t),e(".popup-setting li").attr("foldername",l),o.css("top",i.top+5),o.css("left",r-35),o.show()}),e("body").click(function(){e(".popup-setting").hide()}),e(".popup-setting li").click(function(){var a=e(this).attr("folderid"),r=e(this).attr("action"),t=e(this).attr("foldername");if("delete"==r&&0==confirm("Bạn có chắc muốn xóa , sẽ bị mất hết dữ liệu!"))return;if("addchildfolder"!=r){var o={type:"GET",processData:!0,data:{folderid:a,action:r},contenttype:"application/json"};e.ajax(l,o).then(function(t){var l=e.parseJSON(t);"delete"==r?(e("li.folder#"+a).remove(),alertSuccess(l.alert)):(e("#edit-popup-modal-folder").replaceWith(l.result),e("#edit-popup-modal-folder").modal("show"))})}else e("#add-popup-modal-folder").on("shown.bs.modal",function(r){e("input#folderparent").val(t),e("input#folderparent").attr("parentid",a)})}),e("#add-popup-modal-folder").on("show.bs.modal",function(){e("#add-popup-modal-folder input#foldername").val(""),e(".tree-view-folder").slideUp(),e("#add-popup-modal-folder textarea#folderdes").val("")}),e("#folder_library li.folder").click(function(){e(".alert-warning").text(""),e(".alert-warning").removeClass("alert"),e(".loading-page").addClass("active"),e("#folder_library li.folder").removeClass("active"),e("#folder_library li.folder").addClass("not-allow"),e(this).addClass("active");var a=e(this).attr("id");e('.add-module-popup input[name="selectmodule"]').attr("folderid",a),e("#searchlibrary").attr("folderid",a),e('button[data-target="#add-popup-modal-module"]').show();var r={type:"GET",processData:!0,data:{folderid:a},contenttype:"application/json"};e.ajax(o,r).then(function(a){var r=e.parseJSON(a);e("#table-library").hide().html(r.result).fadeIn("fast"),e("#header-library").replaceWith(r.header),e("#pagination").replaceWith(r.pagination),e(".loading-page").removeClass("active"),""==r.result&&e(".alert-warning").replaceWith(r.alert),e("#folder_library li.folder").removeClass("not-allow")})}),e("#add-new-module").click(function(){var a=e('.add-module-popup input[name="selectmodule"]:checked').val(),r=e('.add-module-popup input[name="selectmodule"]:checked').attr("folderid");window.location.href="course/modedit.php?add="+a+"&type=&course=1&section=1&return=0&sr=&folderid="+r});var i=a.wwwroot+"/library.php";window.location.href==i&&e.getJSON("/local/newsvnr/ajax/library_module_ajax.php",function(a){e("#table-library").hide().html(a.result).fadeIn("fast")}),e("i.library").click(function(){var a={type:"GET",processData:!0,data:{folderid:e("#searchlibrary").attr("folderid"),search:e("#searchlibrary").val().trim()},contenttype:"application/json"};e.ajax(o,a).then(function(a){var r=e.parseJSON(a);e("#table-library tr").remove(),e("#table-library").append(r.result),e("#header-library").replaceWith(r.header),e("#pagination").replaceWith(r.pagination)})}),e("#searchlibrary").keypress(function(a){13==event.which&&e("i.library").click()}),e("#searchlibrary").keyup(function(a){var r=e("#searchlibrary").val().trim();8==a.keyCode&&""==r&&e("i.library").click()})});