define(["jquery","core/config","core/str","core/notification","alertjs"],function(a,e,t,r,o){"use strict";return{init:function(){var r="/local/newsvnr/ajax/library_online/library_folder_ajax.php",i="/local/newsvnr/ajax/library_online/library_module_ajax.php",l="/local/newsvnr/ajax/library_online/library_share_module.php?action=";t.get_strings([{key:"alert",component:"local_newsvnr"},{key:"confirmdeletefolder",component:"local_newsvnr"},{key:"confirmfoldername",component:"local_newsvnr"}]).then(function(t){a("#add-new-folder").click(function(){a(this).addClass("not-allow");var e=a(".add-folder-popup #foldername").val(),i=a(".add-folder-popup #folderparent").attr("parentid"),l=a(".add-folder-popup #folderdes").val(),n={type:"GET",processData:!0,data:{foldername:e,folderid:a(this).attr("forderid"),parentid:i,folderdes:l,action:a(this).attr("action")},contenttype:"application/json"};""!=e?a.ajax(r,n).then(function(e){var t=a.parseJSON(e);o.notify(t.alert,"success",3),location.reload()}):o.alert(t[0],t[2])}),a(".tree-folder .folder").bind("contextmenu",function(e){if(a(".popup-setting").hide(),a(this).hasClass("show"))var t=1;else t=0;var o={type:"POST",processData:!0,data:{visible:t,action:"popupsetting",allmodule:a(this).attr("allmodule"),folderid:a(this).attr("id"),foldername:a(this).text()},contenttype:"application/json"};a(".tree-folder .folder").removeClass("active"),a(this).toggleClass("active");var i=e.clientX;e.preventDefault(),a(this).attr("id"),a(this).text();var l=a(".popup-setting"),n=a(this).position();l.css("top",n.top+5),l.css("left",i-35),a.ajax(r,o).then(function(e){var t=a.parseJSON(e);a.when(a(".popup-setting ul").replaceWith(t.setting)).then(l.show())})}),a("body").click(function(){a(".popup-setting").hide()}),a("#add-popup-modal-folder").on("show.bs.modal",function(){a("#add-popup-modal-folder input#foldername").val(""),a(".tree-view-folder").slideUp(),a("#add-popup-modal-folder textarea#folderdes").val("")}),a("#folder_library li.folder").click(function(){a(".alert-warning").text(""),a(".alert-warning").removeClass("alert"),a(".loading-page").addClass("active"),a("#folder_library li.folder").removeClass("active"),a("#folder_library li.folder").addClass("not-allow"),a(this).addClass("active");var e=a(this).attr("id");a('.add-module-popup input[name="selectmodule"]').attr("folderid",e),a("#searchlibrary").attr("folderid",e),a('button[data-target="#add-popup-modal-module"]').show();var t={type:"GET",processData:!0,data:{folderid:e},contenttype:"application/json"};a.ajax(i,t).then(function(e){var t=a.parseJSON(e);a("#table-library").hide().html(t.result).fadeIn("fast"),a("#header-library").replaceWith(t.header),a("#pagination").replaceWith(t.pagination),a(".loading-page").removeClass("active"),""==t.result&&a(".alert-warning").replaceWith(t.alert),a("#folder_library li.folder").removeClass("not-allow")})}),a("#add-new-module").click(function(){var e=a('.add-module-popup input[name="selectmodule"]:checked').val(),t=a('.add-module-popup input[name="selectmodule"]:checked').attr("folderid");window.location.href="course/modedit.php?add="+e+"&type=&course=1&section=1&return=0&sr=&folderid="+t});var n=e.wwwroot+"/library.php";function d(e){for(var t=a(e).getKendoGrid(),r=t.select(),o=[],i=0;i<r.length;i++)o.push(t.dataItem(r[i]));return o}window.location.href==n&&a.getJSON(i,function(e){a("#table-library").hide().html(e.result).fadeIn("fast"),a("#header-library").replaceWith(e.header),a("#pagination").replaceWith(e.pagination)}),a("i.library").click(function(){var e={type:"GET",processData:!0,data:{folderid:a("#searchlibrary").attr("folderid"),search:a("#searchlibrary").val().trim(),searchtype:a("#searchlibrary").attr("searchtype")},contenttype:"application/json"};a.ajax(i,e).then(function(e){var t=a.parseJSON(e);a("#table-library tr").remove(),a("#table-library").append(t.result),a("#header-library").replaceWith(t.header),a("#pagination").replaceWith(t.pagination),a(".alert-warning").replaceWith(t.alert)})}),a("#searchlibrary").keypress(function(e){13==event.which&&a("i.library").click()}),a("#searchlibrary").keyup(function(e){var t=a("#searchlibrary").val().trim();8==e.keyCode&&""==t&&a("i.library").click()}),a("li.click-expand").each(function(){var e=a(this).attr("id");a(".content-expand."+e).is(":empty")&&a(this).children("i.rotate-icon").remove()}),a("#filter_search_library").bind("change",function(){var e=a(this).val();a("#searchlibrary").attr("searchtype",e),"searchcontent"==e?a(".k-animation-container").addClass("d-none"):a(".k-animation-container").removeClass("d-none")}),a(".nav.multi-tab li a").click(function(){var e=a(this).attr("data-key");a(".nav.multi-tab li a").removeClass("active"),a(this).addClass("active"),a(".tab-content .tab-pane").hide(),a('.tab-content .tab-pane[data="'+e+'"]').fadeIn("fast")}),a("#delete-module-select").click(function(){var e=d("#library-approval-module"),t={type:"POST",processData:!0,data:{dataselect:JSON.stringify(e)}};a.ajax("/local/newsvnr/ajax/library_online/library_approval_module_ajax.php?action=deleteselect",t).then(function(){a("#library-approval-module").data("kendoGrid").dataSource.read()})}),a("#approval-module-select").click(function(){var e=d("#library-approval-module"),t={type:"POST",processData:!0,data:{dataselect:JSON.stringify(e)}};a.ajax("/local/newsvnr/ajax/library_online/library_approval_module_ajax.php?action=approvalselect",t).then(function(){a("#library-approval-module").data("kendoGrid").dataSource.read()})}),a("#table-library").on("click","a#share-module-library",function(e){a("#share-popup-modal-module").modal("show");var t=a(this).attr("moduleid");a("#module-from-library").attr("moduleid",t)}),a("#course-share-input").kendoDropDownList({dataTextField:"name",dataValueField:"courseid",autoBind:!1,filter:"contains",dataSource:{transport:{read:{url:l+"filter_course",contentType:"application/json; charset=utf-8",type:"POST",dataType:"json",serverFiltering:!0}}}}),a("#course-section-input").kendoDropDownList({cascadeFrom:"course-share-input",dataTextField:"name",dataValueField:"sectionid",autoBind:!1,filter:"contains",dataSource:{transport:{read:{url:l+"filter_course_section",contentType:"application/json; charset=utf-8",type:"POST",dataType:"json",serverFiltering:!0}}}}),a("#share-module-library").click(function(){var e={type:"GET",processData:!0,dataType:"json",data:{moduleid:a("#module-from-library").attr("moduleid"),courseid:a("#course-share-input").val(),sectionid:a("#course-section-input").val()}};a.ajax(l+"share_module",e).then(function(a){o.notify(a.success,"success",3)})})})}}});