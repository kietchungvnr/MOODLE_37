require.config({paths:{iframetracker:"//cdn.rawgit.com/vincepare/iframeTracker-jquery/master/dist/jquery.iframetracker"}}),define(["jquery","core/config","core/str","core/notification","theme_moove/handle_cookie","iframetracker","kendo.all.min"],function(e,a,i,o,t,r,d){"use strict";return{init:function(){e(".open-focusmod").bind("click",function(){e("body").hasClass("focusmod")&&t.setCookie("cookie","focusmod");var a=t.getCookie("cookie"),i=t.getCookie("spa"),o=(e(this).attr("course"),e(window).width());"true"==i&&t.setCookie("spa","-1",0),e("#mod-iframe").length<=0&&e("#mod-view-coursepage").html('<div class="alert alert-success mb-0"><strong>'+M.util.get_string("selectcoursedata","theme_moove")+"</strong></div>"),e("#setting-context").addClass("d-none"),e("#sidepreopen-control").addClass("d-none"),"focusmod"==a?(e("body").removeClass("focusmod"),e("body").removeAttr("style"),e("#region-main .loading-page").removeClass("active"),e("#setting-context").removeClass("d-none"),e("#sidepreopen-control").removeClass("d-none"),e(".navbar.focusmod").removeClass("d-flex"),e("#course-main-content").removeClass("d-none"),e("#mod-view-coursepage").addClass("d-none"),e("#page-content").removeAttr("style"),e("#region-main-box").removeAttr("style"),e("#page.container-fluid").removeAttr("style"),e("#page-wrapper").removeAttr("style"),e("#sidepreopen-control").removeClass("d-none"),e("#sidepre-blocks").removeClass("d-none"),e("ul.course").removeClass("d-none"),e("#region-main").removeAttr("style"),e(".fixed-sidebar-left").removeClass("d-none"),e("footer,.all-header,#page-header").slideDown(),o<=576&&e(".nav.multi-tab").slideDown(),t.setCookie("cookie","-1",0)):(e("body").addClass("focusmod"),e("footer,.all-header,#page-header").slideUp(),e(".fixed-sidebar-left").addClass("d-none"),e("#page-wrapper").css("margin-left","0"),e(".navbar.focusmod").addClass("d-flex"),e("ul.course").addClass("d-none"),e("#course-main-content").addClass("d-none"),e("#mod-view-coursepage").removeClass("d-none"),e("#page-content").attr("style","margin-left:0;margin-right:0"),o<=576?e("#region-main-box").attr("style","padding:0!important;margin-top:48px"):e("#region-main-box").attr("style","padding:0!important;margin-top:62px"),e("#page.container-fluid").attr("style","padding: 0!important"),e("#setting-context").addClass("d-none"),e("#sidepreopen-control").addClass("d-none"),e("#sidepre-blocks").addClass("d-none"),e(".nav.multi-tab").slideUp(),t.setCookie("cookie","focusmod"))}),e(window).resize(function(){var a=t.getCookie("cookie"),i=e(window).width(),o=e(window).height(),r=e("#quiz-timer").clone();i<=576&&"focusmod"==a?(e(".list-question-scroll").append(r),e(".nav.multi-tab").slideUp(),e("#region-main-box").attr("style","padding:0!important;margin-top:48px"),e("iframe#mod-iframe").css("height",o)):i>576&&"focusmod"==a&&(e("#quiz-timer").remove(),e("#page-header").slideUp(),e("#region-main-box").attr("style","padding:0!important;margin-top:62px"),e("iframe#mod-iframe").css("height",o-60))}),e(".dropdown-content .card-header.level1").click(function(){var a=e(this).attr("id");e(".card-header#"+a+" .rotate-icon").toggleClass("active"),e(".dropdown-content-2."+a).slideToggle("fast","swing")}),e(".nav-item.mid").click(function(){e(".dropdown-content").is(":empty")?alert("Không có nội dung"):e(".dropdown-content").slideToggle("fast","linear")}),e(".nav-link.prev").click(function(){var a=e(".card-header.level2 a.active").parents("div.level2");if(a.is(":first-child")){var i=e(".card-header.level2 a.active").closest("div.dropdown-content-2").prev();i.length>0&&(e(".card-header .rotate-icon").removeClass("active"),e(".dropdown-content-2").slideUp("fast","swing"),i.prev().prev().trigger("click"),i.prev().children("div:last-child").children("a").trigger("click"))}else a.prev().children("a").trigger("click")}),e(".nav-link.next").click(function(){var a=e(".card-header.level2 a.active").parents("div.level2");if(a.is(":last-child")){var i=e(".card-header.level2 a.active").closest("div.dropdown-content-2").next();i.length>0&&(e(".card-header .rotate-icon").removeClass("active"),e(".dropdown-content-2").slideUp("fast","swing"),i.trigger("click"),i.next().children("div:first-child").children("a").trigger("click"))}else a.next().children("a").trigger("click")}),t.getCookie("baseUrl").includes("course/view.php?id=")&&e("[data-role=1]").length>0&&e(".course-content li.activity a.aalink").bind("click",function(a){a.preventDefault();var i="div.dropdown-content-2 a[module-id="+e(this).parents("li").attr("id").split("-")[1]+"]";e("#focus-mod").trigger("click"),e("#mod-view-coursepage").html(""),setTimeout(function(){e(i).trigger("click"),e(i).parents("div.dropdown-content-2").slideDown()},1e3)}),e("div.card-header.level2 a").click(function(i){var o,r,d=e(this),n=d.attr("data-focusmode-url"),s=d.attr("data-mod-type"),l=e(window).height(),c=e(window).width();if(t.setCookie("cookie","focusmod"),e("body").hasClass("focusmod")&&t.setCookie("cookie","focusmod"),e("#region-main .loading-page").addClass("active"),e("div.card-header.level2 a").removeClass("active"),d.addClass("active").siblings().removeClass("active"),e(".mid .nav-link.focusmod").html(d.text()+'<i class="fa fa-angle-down rotate-icon ml-2"></i>'),e(".nav-link.next, .nav-link.prev").removeClass("disable"),e(".card-header.level2 a").hasClass("active")&&(e(".card-header.level2 a.active").parents().parents("div.dropdown-content-2").prev().is(":first-child")&&e(".card-header.level2 a.active").parents("div.level2").is(":first-child")&&e(".nav-link.prev").addClass("disable"),e(".card-header.level2 a.active").parents().parents("div.dropdown-content-2").is(":last-child")&&e(".card-header.level2 a.active").parents("div.level2").is(":last-child")&&e(".nav-link.next").addClass("disable")),c<=576)var m=!0,v=l;else m=!1,v=l-60;if("resource"==s){e("body").removeAttr("style");var p='<iframe id="mod-iframe" src="'+n+'" height="768" frameBorder="0"></iframe>'}else"quiz"==s?(p='<iframe id="mod-iframe" src="'+n+'" height="'+v+'" frameBorder="0"></iframe>',o={contenttype:"application/json",type:"GET",processData:!0,data:{devicemobile:m}},r=a.wwwroot+"/local/newsvnr/ajax/session.php",e.ajax(r,o).then(function(){})):(e("body").removeAttr("style"),p='<iframe id="mod-iframe" src="'+n+'" frameBorder="0"></iframe>');e("#mod-view-coursepage").html(p),e("#mod-iframe").on("load",function(){e(".dropdown-content").attr("style","display: none"),setTimeout(function(){try{if("resource"==s){var a=e("body").height();e("#mod-iframe").height(a)}else"quiz"==s?e(window).width()>576&&(e("#mod-iframe").removeAttr("height"),iFrameResize({log:!1},"#mod-iframe")):iFrameResize({log:!1},"#mod-iframe");if("quiz"==s){var i=document.getElementById("mod-iframe"),o=(e(window).width(),i.contentWindow.document.querySelectorAll("body")[0].id);if(1==o.includes("page-mod-quiz-attempt")||1==o.includes("page-mod-quiz-summary")||1==o.includes("page-mod-quiz-review")){if(e(".header-quiz").removeAttr("style"),0==e(".back-quiz").length){var t=e("nav.focusmod").eq(0),r=e("div.dropdown-content-2 a.active").text(),d=e("div.dropdown-content-2 a.active").attr("module-id");t.after('<nav class="fixed-top navbar moodle-has-zindex focusmod d-flex header-quiz d-none-mb" id="header-quiz"><div class="loading-page"></div><span class="d-flex m-auto font-weight-bold" style="font-size:22px">'+r+'</span><span class="back-focusmod-desktop back-quiz"  class="cl-cursor"><i class="fa fa-share" style="margin: 0 5px;position: relative;top: 1px;" aria-hidden="true"></i><span style="margin-right:5px">Quay lại</span></span></nav>');var n='<div class="d-flex menu-left">';n+='<div class="course-info-focus">',n+='<div class="icon-back-focusmod back-quiz" ><i class="fa fa-chevron-left mr-1" aria-hidden="true"></i></div>',n+='<div class="page-header-headings"><a>'+r+"</a></div>",n+="</div>",n+="</div>",t.after('<nav class="fixed-top navbar moodle-has-zindex focusmod d-flex header-quiz d-flex-mb" id="header-quiz"><div class="loading-page"></div>'+n+"</nav>"),e("#header-main .loading-page").removeClass("active"),e(".back-quiz").bind("click",function(a){e('div.dropdown-content-2 a[module-id="'+d+'"]').trigger("click"),e("#header-main").removeAttr("style"),e(".header-quiz").attr("style","display: none!important")})}}else e("#header-main").removeAttr("style"),e(".header-quiz").length>0&&e(".header-quiz").attr("style","display: none!important")}e("#region-main .loading-page").removeClass("active")}catch(e){(e.message.indexOf("Blocked a frame with origin")>-1||e.message.indexOf("from accessing a cross-origin frame.")>-1)&&console.log("Same origin Iframe error found!!!")}},1e3)})}),i.get_strings([{key:"general",component:"theme_moove"}]).then(function(a){""==e("div.card-header.level1:first-child() a").text()&&e("div.card-header.level1:first-child() a").append(a[0])}),e(".card-header.level2 a").hasClass("active")||e(".nav-link.prev, .nav-link.next").addClass("disable"),e(".back-focusmod").click(function(){e("#focus-mod").click()}),e(window).width()<=576&&e("html").kendoTouch({enableSwipe:!0,swipe:function(a){e(".tab-pane.active").toggle("slide",function(){e(this).next().toggle("slide",function(){})})}})}}});