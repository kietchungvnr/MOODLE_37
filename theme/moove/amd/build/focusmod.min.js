define(["jquery","core/config","core/str","core/notification"],function(e,a,i,o){"use strict";var t=window.location.href;function n(e){for(var a=e+"=",i=decodeURIComponent(document.cookie).split(";"),o=0;o<i.length;o++){for(var t=i[o];" "==t.charAt(0);)t=t.substring(1);if(0==t.indexOf(a))return t.substring(a.length,t.length)}return""}e(document).ready(function(){t.indexOf("course/view/")>0&&e("#sidepreopen-control").click()}),e(".open-focusmod").bind("click",function(){var a=n("cookie");e(this).attr("course");e("#mod-iframe").length<=0&&e("#mod-view-coursepage").html('<div class="alert alert-success mb-0"><strong>'+M.util.get_string("selectcoursedata","theme_moove")+"</strong></div>"),e("#setting-context").addClass("d-none"),e("#sidepreopen-control").addClass("d-none"),"focusmod"==a?(e("body").removeClass("focusmod"),e("#setting-context").removeClass("d-none"),e("#sidepreopen-control").removeClass("d-none"),e(".navbar.focusmod").removeClass("d-flex"),e("#course-main-content").removeClass("d-none"),e("#mod-view-coursepage").addClass("d-none"),e("#page-content").removeAttr("style"),e("#region-main-box").removeAttr("style"),e("#page.container-fluid").removeAttr("style"),e("#page-wrapper").removeAttr("style"),e("#sidepreopen-control").removeClass("d-none"),e("#sidepre-blocks").removeClass("d-none"),e("ul.course").removeClass("d-none"),e("#region-main").removeAttr("style"),e(".fixed-sidebar-left").removeClass("d-none"),e("footer,.all-header,#page-header").slideDown(),document.cookie="cookie=; max-Age=-1;path=/"):(e("body").addClass("focusmod"),e("footer,.all-header,#page-header").slideUp(),e(".fixed-sidebar-left").addClass("d-none"),e("#page-wrapper").css("margin-left","0"),e(".navbar.focusmod").addClass("d-flex"),e("ul.course").addClass("d-none"),e("#course-main-content").addClass("d-none"),e("#mod-view-coursepage").removeClass("d-none"),e("#page-content").attr("style","margin-left:0;margin-right:0"),e("#region-main-box").attr("style","padding:0!important;margin-top:62px"),e("#page.container-fluid").attr("style","padding: 0!important"),e("#setting-context").addClass("d-none"),e("#sidepreopen-control").addClass("d-none"),e("#sidepre-blocks").addClass("d-none"),function(e,a,i){var o=new Date;o.setTime(o.getTime()+24*i*60*60*1e3);var t="expires="+o.toUTCString();document.cookie=e+"="+a+";"+t+";path=/"}("cookie","focusmod"))}),e(window).resize(function(){var a=n("cookie");e(window).width()<=1050&&"focusmod"==a&&(e(".fixed-top.focusmod .open-focusmod ").trigger("click"),e("#setting-context").removeClass("d-none"),e("#sidepreopen-control").removeClass("d-none"))}),e(".dropdown-content .card-header.level1").click(function(){var a=e(this).attr("id");e(".card-header#"+a+" .rotate-icon").toggleClass("active"),e(".dropdown-content-2."+a).slideToggle("fast","swing")}),e(".nav-item.mid").click(function(){e(".dropdown-content").is(":empty")?alert("Không có nội dung"):e(".dropdown-content").slideToggle("fast","linear")}),e(".nav-link.prev").click(function(){var a=e(".card-header.level2 a.active").parents("div.level2");if(a.is(":first-child")){var i=e(".card-header.level2 a.active").closest("div.dropdown-content-2").prev();i.length>0&&(e(".card-header .rotate-icon").removeClass("active"),e(".dropdown-content-2").slideUp("fast","swing"),i.prev().prev().trigger("click"),i.prev().children("div:last-child").children("a").trigger("click"))}else a.prev().children("a").trigger("click")}),e(".nav-link.next").click(function(){var a=e(".card-header.level2 a.active").parents("div.level2");if(a.is(":last-child")){var i=e(".card-header.level2 a.active").closest("div.dropdown-content-2").next();i.length>0&&(e(".card-header .rotate-icon").removeClass("active"),e(".dropdown-content-2").slideUp("fast","swing"),i.trigger("click"),i.next().children("div:first-child").children("a").trigger("click"))}else a.next().children("a").trigger("click")}),e(".course-content li.activity a.aalink").bind("click",function(a){a.preventDefault();var i=e(this).parents("li").attr("id").split("-")[1];e("#focus-mod").click();var o="div.dropdown-content-2 a[module-id="+i+"]";e("#mod-view-coursepage").html(""),setTimeout(function(){e(o).trigger("click")},500)}),e("div.card-header.level2 a").click(function(a){var i=e(this),o=i.attr("data-focusmode-url"),t=i.attr("data-mod-type");if(e("#region-main .loading-page").addClass("active"),e("div.card-header.level2 a").removeClass("active"),i.addClass("active").siblings().removeClass("active"),e(".mid .nav-link.focusmod").html(i.text()+'<i class="fa fa-angle-down rotate-icon ml-2"></i>'),e(".nav-link.next, .nav-link.prev").removeClass("disable"),e(".card-header.level2 a").hasClass("active")&&(e(".card-header.level2 a.active").parents().parents("div.dropdown-content-2").prev().is(":first-child")&&e(".card-header.level2 a.active").parents("div.level2").is(":first-child")&&e(".nav-link.prev").addClass("disable"),e(".card-header.level2 a.active").parents().parents("div.dropdown-content-2").is(":last-child")&&e(".card-header.level2 a.active").parents("div.level2").is(":last-child")&&e(".nav-link.next").addClass("disable")),"forum"==t||"quiz"==t)var n='<iframe id="mod-iframe" src="'+o+'" width="100%" height="768" frameBorder="0"></iframe>';else n='<iframe id="mod-iframe" src="'+o+'" onload="$(this).height($(this.contentWindow.document.body).find(\'#page-wrapper\').first().height());" width="100%" height="100%" frameBorder="0"></iframe>';e("#mod-view-coursepage").html(n),e("#mod-iframe").on("load",function(){setTimeout(function(){try{if("resource"==t||"forum"==t||"hvp"==t||"quiz"==t){var a=e("body").height()-77;e("#mod-iframe").height(a)}e("#region-main .loading-page").removeClass("active")}catch(e){(e.message.indexOf("Blocked a frame with origin")>-1||e.message.indexOf("from accessing a cross-origin frame.")>-1)&&console.log("Same origin Iframe error found!!!")}},1e3)})}),i.get_strings([{key:"general",component:"theme_moove"}]).then(function(a){""==e("div.card-header.level1:first-child() a").text()&&e("div.card-header.level1:first-child() a").append(a[0])}),e(".card-header.level2 a").hasClass("active")||e(".nav-link.prev, .nav-link.next").addClass("disable")});