define(["jquery","core/config","kendo.all.min","core/str","core/notification","local_newsvnr/initkendocontrolservices","theme_moove/generate_qrcode"],function(e,a,t,n,i,o,r){var l=function(){e("[data-qrcode=qrcode]").bind("click",function(a){var t=e(this).attr("data-qrcontent");r.init("[data-qrcode=qrcode]",t)})};return{init:function(){var t=a.wwwroot+"/local/newsvnr/exam/ajax/examonline.php",i=a.wwwroot+"/examonline.php",r=a.wwwroot+"/local/newsvnr/exam/ajax/exam_grade_report.php";window.location.href==i&&(e.getJSON(t,function(a){e("#table-exam").hide().html(a.result).fadeIn("fast"),l()}),e.getJSON(t+"?action=exam_category",function(a){e("#examonline-category").hide().html(a.category_exam).fadeIn("fast")})),n.get_strings([{key:"listexamrequired",component:"local_newsvnr"},{key:"listexamfree",component:"local_newsvnr"},{key:"subjectexam",component:"local_newsvnr"},{key:"exam",component:"local_newsvnr"}]).then(function(n){function i(){if(1==e("#exam-type").val())var a="exam_filter_free";else a="exam_filter_required";var t={},i={url:r,data:{action:a}};t.optionLabel=n[3]+"...",t.apiSettings=i,t.value="examid";var l=o.initDropDownList(t);e("#examname").kendoDropDownList(l)}function s(){if(1==e("#exam-type").val())var a="subject_filter_free";else a="subject_filter_required";var t={},i={url:r,data:{action:a}};t.cascadeFrom="examname",t.optionLabel=n[2]+"...",t.apiSettings=i,t.value="examsubjectexamid";var l=o.initDropDownList(t);e("#subjectname").kendoDropDownList(l)}e("#examdate").kendoDatePicker(),e("#exam_search_button").click(function(){var a=e("#examdate").val(),n=parseInt((new Date(a).getTime()/1e3).toFixed(0)),i=e("#examname").val(),o=e("#subjectname").val(),r=e("#exam-type").val();e("li").removeClass("active"),e.getJSON(t+"?examid="+i+"&examsubjectexamid="+o+"&date="+n+"&examtype="+r,function(a){e("#table-exam").hide().html(a.result).fadeIn("fast"),e(".loading-page").removeClass("active")})}),e("#exam-type").kendoDropDownList({dataSource:[{text:n[0],value:0},{text:n[1],value:1}],dataTextField:"text",dataValueField:"value",change:function(a){var n={type:"POST",processData:!0,data:{action:"exam_category",examtype:this.value()}};e("#add-quiz").addClass("d-none"),e.ajax(t,n).then(function(a){var t=e.parseJSON(a);e("#examonline-category").hide().html(t.category_exam).fadeIn("fast"),e("#table-exam").hide().html(t.result).fadeIn("fast"),i(),s()})}}),e("#examonline-category").on("click","li.exam",function(a){var n=e(this).attr("id"),i=e("#exam-type").val();e(".loading-page").addClass("active"),e("#menu-tree-exam li.exam").removeClass("active"),e("#menu-tree-exam li.subject-exam").removeClass("active"),e("#menu-tree-exam li.exam").addClass("not-allow"),e("#add-quiz").addClass("d-none"),e(this).addClass("active"),e(".content-expand."+n).slideToggle(),e(this).children("i.rotate-icon").toggleClass("active");var o={type:"POST",processData:!0,data:{examid:n,examtype:i},contenttype:"application/json"};e.ajax(t,o).then(function(a){var t=e.parseJSON(a);e("#table-exam").hide().html(t.result).fadeIn("fast"),l(),e(".loading-page").removeClass("active"),e("#menu-tree-exam li.exam").removeClass("not-allow")})}),e("#examonline-category").on("click","li.subject-exam",function(n){e(".loading-page").addClass("active"),e("#menu-tree-exam li.exam").removeClass("active"),e("#menu-tree-exam li.subject-exam").removeClass("active"),e(this).addClass("active");var i=e(this).attr("data-cancreate"),o=e(this).attr("data-examsujbectexam"),r=a.wwwroot+"/course/modedit.php?add=quiz&type=&course=1&section=0&return=0&sr=0&examsubjectexamid="+o;"true"==i?(e("#add-quiz").attr("href",r),e("#add-quiz").removeClass("d-none")):e("#add-quiz").addClass("d-none");var s={type:"POST",processData:!0,data:{examsubjectexamid:o,examtype:e("#exam-type").val()},contenttype:"application/json"};e.ajax(t,s).then(function(a){var t=e.parseJSON(a);e("#table-exam").hide().html(t.result).fadeIn("fast"),l(),e(".loading-page").removeClass("active")})}),i(),s()})}}});