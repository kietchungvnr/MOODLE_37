define(["jquery","core/config","core/str","core/notification"],function(t,e,n,a){"use strict";var c,i,s,o="",r={SECLECTHELPBOX:".help-content-chatbot li",SELECTTAGHELP:".tag-chatbot",SUGGESTIONTAGSBOX:".bot-caption",BOTRESPONSEWAIT:"#response-animation",KEYUPINPUTMESSAGE:"input[name=send-message]",CHATBOTICON:"#chatbot-icon",CHATBOTCHAT:"#chatbot-chat",BUTTONCLOSEBOXCHAT:".tpl-close",BUTTONIMAGESENDMSG:".send-icon path",BUTTONSENDMSG:"#send-message",MAINCONVERSATION:".main-conversation-chatbot",BOTCHAT:".bot-chat",USERCHAT:".user-chat",TYPEINGMESSAGE:".typing-chatbot",MINIPOPUPCHATBOT:".mini-popup-chatbot"},l=e.wwwroot;function p(){t(".conversation-chatbot").animate({scrollTop:document.body.scrollHeight},"fast")}t(document).ready(function(){t(r.CHATBOTICON).click(function(){0==t(r.MAINCONVERSATION+" .bot-chat").length&&(t(r.TYPEINGMESSAGE).attr("style","pointer-events: none"),O("hi").then(async e=>{t(r.TYPEINGMESSAGE).removeAttr("style"),t(r.BOTRESPONSEWAIT).replaceWith(g(e)),async function(){var e=u("B·∫°n c√≥ c·∫ßn t√¥i h·ªó tr·ª£ hay kh√¥ng ü§ó?");await E(e),g(b),t("#chatbot-yesno span").click(async function(){if(o=t(this).text(),t("#chatbot-yesno").remove(),"Kh√¥ng"==o){g(d(o));var e=u('N·∫øu b·∫°n c·∫ßn h·ªó tr·ª£, vui l√≤ng nh·∫≠p "tr·ª£ gi√∫p" ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£!');await E(e)}else if("C√≥"==o){g(d(o));var n=u("Ch·ªçn 1 trong c√°c l·ª±a ch·ªçn b√™n d∆∞·ªõi ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£ üëá");await E(n),g(m),t("#chatbot-topic span").click(function(){S(o=t(this).text()),t("#chatbot-topic").remove()})}})}()})),t(this).animate({bottom:"-55px"}),t(this).slideToggle(),t(r.MINIPOPUPCHATBOT).fadeOut("fast"),t(r.CHATBOTCHAT).slideToggle()}),t(r.BUTTONCLOSEBOXCHAT).click(function(){t(r.CHATBOTICON).animate({bottom:"55px"}),t(r.CHATBOTCHAT).slideToggle(),t(r.CHATBOTICON).slideToggle()}),t(r.KEYUPINPUTMESSAGE).keyup(function(){t(r.BUTTONIMAGESENDMSG).attr("fill","#006cff"),""==t(r.KEYUPINPUTMESSAGE).val()&&t(r.BUTTONIMAGESENDMSG).attr("fill","#d7d7d7")}),t(r.MINIPOPUPCHATBOT).on("click",function(){t(r.MINIPOPUPCHATBOT).fadeOut("slow")})});async function h(){var e=u("B·∫°n c√≥ mu·ªën ƒë∆∞·ª£c h·ªó tr·ª£ th√™m?");await E(e),g(b),t("#chatbot-yesno span").click(async function(){if(o=t(this).text(),p(),t("#chatbot-yesno").remove(),"Kh√¥ng"==o){var e=u('N·∫øu b·∫°n c·∫ßn h·ªó tr·ª£, vui l√≤ng nh·∫≠p "tr·ª£ gi√∫p" ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£!');await E(e)}else if("C√≥"==o){g(d(o));var n=u("H√£y ch·ªçn 1 trong nh·ªØng l·ª±a ch·ªçn b√™n d∆∞·ªõi ƒë·ªÉ ti·∫øp t·ª•c üëá!");await E(n),g(m),t("#chatbot-topic span").click(function(){o=t(this).text(),p(),S(o),t("#chatbot-topic").remove()})}})}function d(t){var e='<div class="user-chat">';return e+='<div class="user-response-wrapper">',e+='<div class="tpl-text-response-wrapper" data-type="user">',e+='<div class="tpl-text-response">',e+=t,e+="</div>",e+="</div>",e+="</div>",e+="</div>"}function u(t){var e='<div class="bot-chat">';return e+='<div class="user-response-wrapper">',e+='<div class="tpl-text-response-wrapper" data-type="bot">',e+='<div class="tpl-text-response">',e+=t,e+="</div>",e+="</div>",e+="</div>",e+="</div>"}function v(){return'<div class="user-response-wrapper">','<div class="tpl-text-response-wrapper" data-type="bot">','<div class="tpl-text-response">','<span class="spinme-left">','<div class="spinner">','<div class="bounce1"></div><div class="bounce2"></div><div class="bounce3">',"</div>","</span>","</div>","</div>","</div>","</div>",'<div class="bot-chat" id="response-animation"><div class="user-response-wrapper"><div class="tpl-text-response-wrapper" data-type="bot"><div class="tpl-text-response"><span class="spinme-left"><div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></span></div></div></div></div>'}function T(e,n){var a='<div class="respone-tag-help-chat mt-0" id="'+n+'">';return a+='<div class="user-response-wrapper">',a+='<div class="tpl-text-response-wrapper" data-type="help">',a+='<div class="tpl-text-response">',a+='<div class="bot-caption m-0">',t.map(e,function(t,e){a+='<span class="tag-chatbot mr-2 mt-1">',a+=t,a+="</span>"}),a+="</div>",a+="</div>",a+="</div>",a+="</div>",a+="</div>"}function b(){return T(["C√≥","Kh√¥ng"],"chatbot-yesno")}function m(){return T(["Kh√≥a h·ªçc","Kh√≥a gi·∫£ng","B√†i ki·ªÉm tra","B√†i t·∫≠p v·ªÅ nh√†"],"chatbot-topic")}function f(){return T(["Xem danh s√°ch kh√≥a h·ªçc","Xem danh s√°ch kh√≥a gi·∫£ng","Xem danh s√°ch s√°ch ƒëi·ªÉm c·ªßa c√°c kh√≥a h·ªçc","Xem s·ª± ki·ªán s·∫Øp h·∫øt h·∫°n","Xem kh√≥a h·ªçc s·∫Øp h·∫øt h·∫°n"],"chatbot-help-topic")}function g(e){t(".main-conversation-chatbot").append(e)}t.urlParam=function(e){var n=t(".text-username").attr("href"),a=new RegExp("[?&]"+e+"=([^&#]*)").exec(n);return null==a?null:decodeURI(a[1])||0};var y=(e,n)=>{var a="";return g(v()),t.ajax(e,n).then(t=>{var e=t.data[0].html;return g(u(t.data[0].message)),null!=e&&(a=""==e?u(e):function(t){var e='<div class="respone-tag-help-chat">';return e+='<div class="user-response-wrapper">',e+='<div class="tpl-text-response-wrapper" data-type="help">',e+='<div class="tpl-text-response">',e+=t,e+="</div>",e+="</div>",e+="</div>",e+="</div>"}(e)),p(),Promise.resolve(a)})},O=async function(e){var n=parseInt(t.urlParam("id"));e=e.toLowerCase();switch(function(e){t.map(e,function(e,n){t(e).length>0&&t(e).remove()})}(["#chatbot-yesno","#chatbot-topic"]),!0){case e.includes("t·∫°m bi·ªát")||e.includes("bye")||e.includes("tho√°t")||e.includes("exit"):var a=u("T·∫°m bi·ªát, n·∫øu c·∫ßn h·ªó tr·ª£ h√£y g·ªçi t√¥i nh√© üòò!");await E(a);break;case e.includes("hi")||e.includes("xin ch√†o")||e.includes("hello"):return y(s=l+"/local/newsvnr/api/chatbot/hello",i={type:"POST",data:{userid:n},contenttype:"application/json"});case e.includes("kh√≥a h·ªçc"):return i={type:"POST",data:{userid:n,roleid:5},contenttype:"application/json"},s=l+"/local/newsvnr/api/chatbot/mycourses",await y(s,i).then(t=>{console.log(t),g(t),h()});case e.includes("kh√≥a gi·∫£ng"):return i={type:"POST",data:{userid:n,roleid:3},contenttype:"application/json"},s=l+"/local/newsvnr/api/chatbot/mycourses",await y(s,i).then(t=>{console.log(t),g(t),h()});case e.includes("help")||e.includes("tr·ª£ gi√∫p"):a=u("Ch·ªçn ch·ªß ƒë·ªÅ ho·∫∑c vi·∫øt c√¢u h·ªèi c·ªßa b·∫°n b√™n d∆∞·ªõi üëá!");await E(a),g(f),t("#chatbot-help-topic span").click(async function(){o=t(this).text(),p(),S(o),t("#chatbot-help-topic").remove()});break;default:await E(u("Kh√¥ng t√¨m th·∫•y th√¥ng tin n√†o li√™n quan ƒë·∫øn y√™u c·∫ßu c·ªßa ban. H√£y ch·∫Øc ch·∫Øn y√™u c·∫ßu c√≥ nghƒ©a!"));var c=u("B·∫°n c√≥ c·∫ßn t√¥i h·ªó tr·ª£ hay kh√¥ng ü§ó?");await E(c),g(b),p(),t("#chatbot-yesno span").click(async function(){if(o=t(this).text(),p(),t("#chatbot-yesno").remove(),"Kh√¥ng"==o){var e=u('N·∫øu b·∫°n c·∫ßn t√¥i, vui l√≤ng nh·∫≠p "tr·ª£ gi√∫p" ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£!');await E(e)}else if("C√≥"==o){g(d(o));var n=u("Ch·ªçn 1 trong c√°c l·ª±a ch·ªçn b√™n d∆∞·ªõi üëá!");await E(n),g(m),t("#chatbot-topic span").click(function(){o=t(this).text(),p(),S(o),t("#chatbot-topic").remove()})}})}return Promise.resolve("")};async function E(e=""){var n,a;g(v()),await(n=500,new Promise(function(t){setTimeout(t.bind(null,a),n)})).then(n=>{t(r.BOTRESPONSEWAIT).replaceWith(e),p()})}function S(e=""){""!=e?c=e:(c=t(r.BUTTONSENDMSG).val(),document.getElementById("send-message").value="",document.getElementById("send-message").placeholder="Type your message here"),g(d(c)),O(c).then(e=>{t(r.BOTRESPONSEWAIT).replaceWith(g(e)),p()})}document.onkeypress=function(e){var n=e||window.event,a=n.keyCode||n.which;""!=t(r.BUTTONSENDMSG).val()&&(13!=a&&3!=a||(p(),S()))}});