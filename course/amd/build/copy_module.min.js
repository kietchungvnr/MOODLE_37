define(["jquery","core/str","core/modal_factory","core/modal_events","core/ajax","core/fragment","core/notification","core/config","core/templates"],function(e,t,o,s,a,l,r,n,c){var d='<p class="text-center"><i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i></p>';function m(e){return e.clone().addClass("custom-placeholder").removeClass("k-ghost")}function p(e){t.get_string("copymodule","theme_moove").then(function(t){o.create({type:o.types.DEFAULT,title:t,body:d,large:!0}).done(function(t){var o=t.getRoot();o.on(s.hidden,function(){o.remove()}.bind(this)),c.render("core_course/copy_module",e).done(function(e,o){t.setBody(e),c.runTemplateJS(o)}),t.show()})}).catch(function(){r.exception(new Error("Failed to load string: loading"))})}return{init:function(o,s){var a={courseid:o,userid:s};e("#action-menu-2-menu .dropdown-item a").click(function(){"data-action-copy-module=popup"==e("i",this).attr("title")&&p(a)}),e("#page-course-admin li a").click(function(){var o=this;t.get_string("copymodule","theme_moove").then(function(t){e(o).text()===t&&p(a)})})},initTemplateJs:function(o){e(document).ready(function(){var s=n.wwwroot+"/course/ajax/copy_module.php",a="rgb(230,230,230)",l=1,r=e("#coppy-modules section").length;e("#coppy-modules #prev").addClass("disabled"),e("#coppy-modules #submit").addClass("disabled"),e("#coppy-modules section").not("section:nth-of-type(1)").hide(),e("#coppy-modules section").not("section:nth-of-type(1)").css("transform","translateX(100px)");var c=200*r+24;function d(e,t){var o=document.createElementNS("http://www.w3.org/2000/svg",e);for(var s in t)o.setAttribute(s,t[s]);return o}for(e("#coppy-modules #svg_wrap").html('<svg version="1.1" id="svg_form_time" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 '+c+' 24" xml:space="preserve"></svg>'),i=0;i<r;i++){var p=12+200*i,u=d("rect",{x:p,y:9,width:200,height:6});document.getElementById("svg_form_time").appendChild(u);var f=d("circle",{cx:p,cy:12,r:12,width:p,height:6});document.getElementById("svg_form_time").appendChild(f)}f=d("circle",{cx:p+200,cy:12,r:12,width:p,height:6}),document.getElementById("svg_form_time").appendChild(f),e("#coppy-modules #svg_form_time rect").css("fill",a),e("#coppy-modules #svg_form_time circle").css("fill",a),e("#coppy-modules circle:nth-of-type(1)").css("fill","rgb(45, 91, 124)"),e("#coppy-modules .button").click(function(){e("#coppy-modules #svg_form_time rect").css("fill","rgb(45, 91, 124)"),e("#coppy-modules #svg_form_time circle").css("fill","rgb(45, 91, 124)");var t=e(this).attr("id");"next"==t?(e("#coppy-modules #prev").removeClass("disabled"),l>=r&&(e(this).addClass("disabled"),e("#coppy-modules #submit").removeClass("disabled")),l<=r&&l++):"prev"==t&&(e("#coppy-modules #next").removeClass("disabled"),e("#coppy-modules #submit").addClass("disabled"),l<=2&&e(this).addClass("disabled"),l>1&&l--);var o=l+1;e("#coppy-modules #svg_form_time rect:nth-of-type(n + "+l+")").css("fill",a),e("#coppy-modules #svg_form_time circle:nth-of-type(n + "+o+")").css("fill",a);var s=e("#coppy-modules section:nth-of-type("+l+")");s.fadeIn(),s.css("transform","translateX(0)"),s.prevAll("section").css("transform","translateX(-100px)"),s.nextAll("section").css("transform","translateX(100px)"),e("#coppy-modules section").not(s).hide()});var v='<div class="mt-1">#= data.module_icon ##: data.name #</div>';e("#copy-module-optional").kendoListBox({selectable:"multiple",dataTextField:"name",dataValueField:"value",template:v,dataSource:{transport:{read:{type:"GET",processData:!0,dataType:"json",contenttype:"application/json",url:s,data:{action:"list_module",courseid:o.courseid}}}},draggable:{placeholder:m},dropSources:["copy-module-selected"],connectWith:"copy-module-selected",toolbar:{position:"right",tools:["transferTo","transferFrom","transferAllFrom","transferAllTo"]},messages:{tools:{moveUp:"Promote",moveDown:"Demote",remove:"Remove Employee",transferTo:"Transfer To",transferFrom:"Transfer From",transferAllTo:"Transfer All To",transferAllFrom:"Transfer All From"}}}),e("#copy-module-selected").kendoListBox({selectable:"multiple",dataTextField:"name",dataValueField:"value",template:v,draggable:{placeholder:m},dropSources:["copy-module-optional"],connectWith:"copy-module-optional"}),t.get_string("selectcourse","theme_moove").then(function(t){e("#list_course").kendoMultiSelect({placeholder:t+"...",dataTextField:"name",dataValueField:"value",dataSource:{transport:{read:{type:"GET",processData:!0,dataType:"json",contenttype:"application/json",url:s,data:{action:"list_course",userid:o.userid}},parameterMap:function(e,t){if("read"==t)return e.filter&&e.filter.filters[0]&&(e.q=e.filter.filters[0].value),e}},schema:{model:{fields:{coursid:{type:"number"},coursename:{type:"string"}}}},pageSize:30,serverPaging:!0,serverFiltering:!0}})}),e("#submit").click(function(o){o.preventDefault();var a=[],l=e("#copy-module-selected").data("kendoListBox"),r=e("#list_course").data("kendoMultiSelect"),n=l.dataItems(),i=(n=e.map(n,function(e,t){return e.value})).join(","),c=r.value().toString();t.get_strings([{key:"courserequired",component:"theme_moove"},{key:"modulerequired",component:"theme_moove"},{key:"copyingdata",component:"theme_moove"}]).then(function(t){if(e("#hanlde_message").html(""),""==c&&(a.push("course"),e("#hanlde_message").append("<div class='alert alert-warning mt-3'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a>"+t[0]+"</div>")),""==i&&(a.push("module"),e("#hanlde_message").append("<div class='alert alert-warning mt-3'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a>"+t[1]+"</div>")),a.length>0)return setTimeout(function(){e("#hanlde_message").html("")},5e3),0;e("#hanlde_message").html("<div class='alert alert-success mt-3'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a>"+t[2]+"</div>"),e.ajax({type:"GET",processData:!0,dataType:"json",contenttype:"application/json",url:s,data:{action:"copy_module",listmodule:i,listcourse:c},beforeSend:function(){e("#process").css("display","block")},success:function(t){var o=0;r.value([]);var s=setInterval(function(){!function(t,o,s){e("#process .progress-bar").css("width",t+"%"),t>100&&(clearInterval(o),e("#process").css("display","none"),e("#process .progress-bar").css("width","0%"),e("#save").attr("disabled",!1),e("#hanlde_message").html("<div class='alert alert-success mt-3'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a>"+s.success+"</div>"),setTimeout(function(){e("#hanlde_message").html("")},5e3))}(o+=20,s,t)},1e3)}})})})})}}});