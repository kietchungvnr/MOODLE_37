define(["jquery","core/config","core/templates","core/notification"],function(t,n,e,i){"use strict";Math.floor(Date.now()/1e3);var a,o=n.wwwroot+"/mod/book/ajax.php",r=function(n,e,r,c){try{if(!c)return;var p,s,f=n;r=r;a=setInterval(function(){if(p=parseInt(f/60,10),s=parseInt(f%60,10),p=p<10?"0"+p:p,s=s<10?"0"+s:s,e.textContent=p+":"+s,--f<0){clearInterval(a);var c=e.innerText.split(":"),u=60*+c[0]+ +c[1];return r.data.spenttime=n-u,t.ajax(o,r).then(function(t){}).fail(i.exception),!0}},1e3)}catch(t){if(t instanceof TypeError==!0)return!1}};return{init:function(n,e){!function(n,e){var a={type:"GET",data:{cmid:n,instance:e,action:1,spenttime:""},processData:!0,contentType:"application/json"};t.ajax(o,a).then(function(a){var c=a.completiontimespent,p={type:"GET",data:{cmid:n,instance:e,action:2,spenttime:0},processData:!0,contentType:"application/json"};if("completed"!==c){var s=a.completiontimespent,f=document.querySelector("#time");r(s,f,p,!0),window.onbeforeunload=function(){var n=f.innerText.split(":");s=60*+n[0]+ +n[1],p.data.spenttime=c-s,t.ajax(o,p).then(function(t){}).fail(i.exception)}}return!0})}(n,e)}}});