define(["jquery","core/config","validatefm","local_newsvnr/initkendogrid","alertjs","core/str","kendo.all.min","local_newsvnr/initkendocontrolservices"],function(t,e,r,n,i,a,s,o){"use strict";let l="#learning_report",c={},u=e.wwwroot+"/local/newsvnr/report/ajax/learning_report.php";var g=function(e){var r={url:u,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",data:e},i=[{template:function(t){return t.useravatar+"<a href='"+t.userhref+"' target='_blank'>"+t.name+"</a>"},field:"name",title:M.util.get_string("studentname","local_newsvnr"),width:"100px"},{template:function(t){return"<a href='"+t.coursehref+"' target='_blank'>"+t.coursename+"</a>"},field:"coursename",title:M.util.get_string("course","local_newsvnr"),width:"120px"},{template:"<div class='d-flex participants-collum'><div class='progress course'><div class='progress-bar' role='progressbar' aria-valuenow='#: process #' aria-valuemin='0' aria-valuemax='100' style='width:#: process #'></div></div><div></div></div></div>",field:"process",title:M.util.get_string("learningprocess","local_newsvnr"),width:"100px"},{template:function(t){return'<div class="text-center"><span class="badge text-white '+t.classstatus+' font-weight-bold rounded p-2">'+t.status+"</span></div>"},field:"status",title:M.util.get_string("status","local_newsvnr"),width:"100px"},{field:"timestart",title:M.util.get_string("joindate","local_newsvnr"),width:"100px"},{field:"timecompleted",title:M.util.get_string("timefinishcourse","local_newsvnr"),width:"70px"},{field:"timeaccess",title:M.util.get_string("timeaccess","local_newsvnr"),width:"80px"},{field:"grade",title:M.util.get_string("grade","local_newsvnr"),width:"100px"}];c.onChange=function(){t.map(this.select(),function(e){return t(e).text()}).length>0?t("#exporttable").addClass("action"):t("#exporttable").removeClass("action")},c.toolbar=["excel"],c.excel={fileName:"Report.xlsx",allPages:!0},c.columns=i,c.apiSettings=r;var a=n.initGrid(c);t(l).data("kendoGrid")&&t(l).data("kendoGrid").destroy(),t(l).kendoGrid(a)};return{init:function(){g(),t("#searchorgs").click(function(){!function(t,e){g({action:"searchorgstructure",orgstructureid:t,positionid:e})}(t("#orgstructure").val(),t("#orgstructure_position").val())}),t("#searchaccount").click(function(){!function(t,e,r,n,i,a,s,o){g({action:"searchaccount",username:t,datestart:e,dateend:r,courseid:n,status:i,startprocess:a,endprocess:s,grade:o})}(t("#username").val(),t("#start_timeaccess").val(),t("#end_timeaccess").val(),t("#course").val(),t("#status").val(),t("#start_process").val(),t("#end_process").val(),t("#grade").val())}),t("#resettable").click(function(){g()}),t("#changereport").click(function(){var r=t("#report").val();r?location.replace(e.wwwroot+"/local/newsvnr/report/"+r+".php"):i.alert("Thông báo","Vui lòng chọn báo cáo!")}),t("#exporttable").on("click",function(e){var r=t("#learning_report").find("tr");if(t(r).find(":checkbox").is(":checked")){var n=[{cells:[{value:M.util.get_string("studentname","local_newsvnr")},{value:M.util.get_string("course","local_newsvnr")},{value:M.util.get_string("learningprocess","local_newsvnr")},{value:M.util.get_string("status","local_newsvnr")},{value:M.util.get_string("joindate","local_newsvnr")},{value:M.util.get_string("timefinishcourse","local_newsvnr")},{value:M.util.get_string("timeaccess","local_newsvnr")},{value:M.util.get_string("grade","local_newsvnr")}]}];exportExcelKendo("#learning_report",n)}else t(".k-grid-excel").click()})},kendoDropdown:function(){var e="/local/newsvnr/report/ajax/report_data.php?action=";t("#start_timeaccess").kendoDatePicker({change:function(){t("#end_timeaccess").val("");var e=t("#start_timeaccess").val().split("/");if(e.length>1){var r=t("#end_timeaccess").data("kendoDatePicker"),n=parseInt(e[2]),i=parseInt(e[0]),a=parseInt(e[1]);r.setOptions({min:new Date(n,i-1,a+1)})}}}),t("#end_timeaccess").kendoDatePicker(),(s={}).apiSettings={url:e+"get_course"},s.value="value",s.optionLabel=M.util.get_string("selectcourse","local_newsvnr");var r=o.initDropDownList(s);t("#course").kendoDropDownList(r),(s={}).apiSettings={url:e+"get_orgstructure_category"},s.value="categoryid",s.optionLabel=M.util.get_string("selectorgstructuretype","local_newsvnr");var n=o.initDropDownList(s);t("#orgstructure_category").kendoDropDownList(n),(s={}).apiSettings={url:e+"get_orgstructure"},s.value="orgid",s.optionLabel=M.util.get_string("selectorgstructure","local_newsvnr"),s.cascadeFrom="orgstructure_category";var i=o.initDropDownList(s);t("#orgstructure").kendoDropDownList(i),(s={}).apiSettings={url:e+"get_orgstructure_jobtitle"},s.value="jobtitleid",s.optionLabel=M.util.get_string("selectjobtitle","local_newsvnr");var a=o.initDropDownList(s);t("#orgstructure_jobtitle").kendoDropDownList(a),(s={}).apiSettings={url:e+"get_orgstructure_position"},s.value="positionid",s.optionLabel=M.util.get_string("selectjobposition","local_newsvnr"),s.cascadeFrom="orgstructure_jobtitle";var s,l=o.initDropDownList(s);t("#orgstructure_position").kendoDropDownList(l),(s={}).apiSettings={url:e+"get_learning_status"},s.value="value",s.optionLabel=M.util.get_string("select","local_newsvnr");var c=o.initDropDownList(s);t("#status").kendoDropDownList(c),t("#start_process").kendoNumericTextBox({format:"p0",factor:100,min:0,max:1,step:.01}),t("#end_process").kendoNumericTextBox({format:"p0",factor:100,min:0,max:100,step:1}),t("#grade").kendoNumericTextBox({format:"0",decimals:0,min:0,max:100,step:1})}}});