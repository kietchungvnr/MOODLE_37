define(["jquery","kendo.all.min","core/config","core/notification","dttable","core/str"],function(e,t,a,r,o,n){return{orgmain:function(){$body=e("body");e("#search-term").val();var t,o,i,s=a.wwwroot+"/local/newsvnr/ajax.php";e('[data-region="buttons-iframe"] #userdetail_orgstructure').click(function(){e('[data-region="userdetail-iframe"]').removeClass("d-none")}),$body.addClass("loading"),e.ajax(s,{type:"GET",data:{org_struct:1},processData:!0,contentType:"application/json"}).then(function(a){a.error?r.addNotification({message:a.error,type:"error"}):(void 0!==window.M.core_formchangechecker&&window.M.core_formchangechecker.reset_form_dirty_state(),e("#search-term").on("keyup",function(){var a=e("#treeview-sprites").getKendoTreeView();if(a.dataSource.data(t),""!=e.trim(e(this).val())){var r=this.value.toUpperCase(),o=r.length;e("#treeview-sprites span.k-in").each(function(t){for(var n=e(this).text(),i="",s=0;(p=n.toUpperCase().indexOf(r,s))>=0;)i+=n.substring(s,p)+'<span class="highlight">'+n.substr(p,o)+"</span>",s=p+o;s>0&&(i+=n.substring(s),a.dataItem(e(this)).set("text",i),e(this).parentsUntil(".k-treeview").filter(".k-item").each(function(t,a){e("#treeview-sprites").data("kendoTreeView").expand(e(this)),e(this).data("search-term",r)}))}),e("#treeview-sprites .k-item").each(function(){e(this).data("search-term")!=r&&e("#treeview-sprites").data("kendoTreeView").collapse(e(this))})}}),t=JSON.parse(a),o=e("#treeview-sprites").kendoTreeView({dataSource:t}).data("kendoTreeView"),$body.removeClass("loading"))}).fail(r.exception),e("#treeview-sprites").on("click","",function(){e('[data-region="buttons-iframe"] #orgstructuredetail').removeClass("btn-primary"),e('[data-region="buttons-iframe"] #list_users').removeAttr("disabled"),e('[data-region="buttons-iframe"] #orgstructuredetail').removeAttr("disabled");var t=o.select(),s=o.dataItem(t);if(s){var l=s.id,d=s.text;document.getElementById("search-term").value=d.toString().replace(/<\/?[^>]+>/gi,"")}var c={type:"GET",data:{section:"orgmain_list",orgstructureid:l},processData:!0,contentType:"application/json"};$body.addClass("loading");var p=a.wwwroot+"/local/newsvnr/ajax/orgdata.php";$body.removeClass("loading"),e.ajax(p,c).then(function(t){if(t.error)r.addNotification({message:t.error,type:"error"});else{var o=JSON.parse(t);e("#show_orgform").html(o.form);n.get_strings([{key:"nodatatable",component:"local_newsvnr"},{key:"usercode",component:"local_newsvnr"},{key:"username",component:"local_newsvnr"},{key:"orgstructureunder",component:"local_newsvnr"},{key:"position_name",component:"local_newsvnr"},{key:"compstandard",component:"local_newsvnr"},{key:"compless",component:"local_newsvnr"},{key:"courselink",component:"local_newsvnr"},{key:"evidence",component:"local_newsvnr"},{key:"timecompletecourse",component:"local_newsvnr"},{key:"completed",component:"local_newsvnr"},{key:"progress",component:"local_newsvnr"}]).then(function(t){columns=[{template:'<div class="hyperlink" data-toggle="tooltip-usercode" title="Nhấn DoubleClick xem chi tiết nhân viên">#: usercode #</div>',field:"usercode",title:t[1],width:"200px"},{template:'<div class="hyperlink" data-toggle="tooltip-usercode" title="Nhấn DoubleClick xem chi tiết nhân viên">#: uname #</div>',field:"uname",title:t[2],width:"200px"},{field:"oname",title:t[3],width:"200px"},{field:"opname",title:t[4],width:"200px"},{field:"positioncomp",title:t[5],width:"200px"},{field:"positioncomp_number",title:t[6],width:"200px"}];var o=a.wwwroot+"/local/newsvnr/ajax/orgdata.php?section=orgmain_list&orgstructureid="+l;null==i&&"undefined"===i||e("#showtable_data").empty(),i=e("#showtable_data").kendoGrid({dataSource:{transport:{read:{url:o,dataType:"json",contentType:"application/json; charset=utf-8",type:"GET"},parameterMap:function(e,t){if("read"==t)return e.filter&&(e.q=e.filter.filters[0].value),e}},schema:{data:"userdata",total:function(e){if(null!=e.userdata&&e.userdata.length>0)return e.userdata[0].total}},pageSize:10,serverPaging:!0,serverFiltering:!0,serverSorting:!0},toolbar:["search"],search:{fields:["usercode"]},sortable:{mode:"single",allowUnsort:!1,field:"usercode"},reorderable:!0,groupable:!1,resizable:!0,filterable:!0,columnMenu:!0,pageable:{refresh:!0,pageSizes:!0,buttonCount:5},change:function(o){var n=this;e.map(this.select(),function(o){var i=n.dataItem(o),s={type:"GET",data:{section:"orgmain_list",modalsection:"modalinfo",orgstructureid:l,usercode:i.usercode},processData:!0,contentType:"application/json"},d=a.wwwroot+"/local/newsvnr/ajax/orgdata.php",c=a.wwwroot+"/local/newsvnr/ajax/orgdata.php?section=orgmain_list&modalsection=gridinfo&orgstructureid="+l+"&usercode="+i.usercode;$body.addClass("loading"),e.ajax(d,s).then(function(a){var r=JSON.parse(a);e("#showmodal_data").html(r.modal),e("#userdetail").modal("toggle"),e("#userdetailtable").kendoGrid({dataSource:{transport:{read:{url:c,dataType:"json",contentType:"application/json; charset=utf-8",type:"GET"},parameterMap:function(e,t){if("read"==t)return e.filter&&(e.q=e.filter.filters[0].value),e}},schema:{total:function(e){if(null!=e&&e.length>0)return e[0].total}}},scrollable:!0,columns:[{field:"competency",title:t[5],width:300},{template:function(e){return e.courselink},field:"courselink",title:t[7],width:300},{template:function(e){return e.courseprogress},title:t[11],width:200},{template:function(e){return e.evidence},field:"evidence",title:t[8],width:100},{template:function(e){return e.timecompleted},field:"timecompleted",title:t[9],width:200},{template:function(e){return e.completed},field:"completed",title:t[10],width:150}]}),$body.removeClass("loading")}).fail(r.exception)})},selectable:!0,columns:columns}).data("kendoGrid"),$body.removeClass("loading");e('[data-region="buttons-iframe"] #orgstructuredetail').click(function(){e(this).addClass("btn-primary"),e('[data-region="buttons-iframe"] #list_users').removeClass("btn-primary"),e("#show_orgform").removeClass("d-none"),e("#showtable_data").addClass("d-none")}),e('[data-region="buttons-iframe"] #list_users').click(function(){e(this).addClass("btn-primary"),e('[data-region="buttons-iframe"] #orgstructuredetail').removeClass("btn-primary"),e("#showtable_data").removeClass("d-none"),e("#show_orgform").addClass("d-none")})})}}).fail(r.exception)})}}});