define(["jquery","kendo.all.min","core/config","core/notification","dttable","core/str"],function(e,t,a,o,i,n){return{orgcomp_position:function(){e(".list-group .comp").click(function(){var i,n=this.id,r=a.wwwroot+"/local/newsvnr/ajax.php",c={type:"GET",data:{org_competency:1,frameid:n},processData:!0,contentType:"application/json"};e.ajax(r,c).then(function(a){if(a.error)o.addNotification({message:a.error,type:"error"});else{void 0!==window.M.core_formchangechecker&&window.M.core_formchangechecker.reset_form_dirty_state();var n=JSON.parse(a);if(e("#tree-competency").getKendoTreeView()){i=e("#tree-competency").getKendoTreeView();var r=new t.data.HierarchicalDataSource({data:n});i.setDataSource(r)}else i=e("#tree-competency").kendoTreeView({dataSource:n}).data("kendoTreeView");e("#value-item").on("keyup",function(){var t=e("#tree-competency").getKendoTreeView();if(t.dataSource.data(n),""!=e.trim(e(this).val())){var a=this.value.toUpperCase(),o=a.length;e("#tree-competency span.k-in").each(function(i){for(var n=e(this).text(),r="",c=0;(p=n.toUpperCase().indexOf(a,c))>=0;)r+=n.substring(c,p)+'<span class="highlight">'+n.substr(p,o)+"</span>",c=p+o;c>0&&(r+=n.substring(c),t.dataItem(e(this)).set("text",r),e(this).parentsUntil(".k-treeview").filter(".k-item").each(function(t,o){e("#tree-competency ").data("kendoTreeView").expand(e(this)),e(this).data("value-item",a)}))}),e("#tree-competency .k-item").each(function(){e(this).data("value-item")!=a&&e("#tree-competency ").data("kendoTreeView").collapse(e(this))})}}),e("#tree-competency").click(function(){var t=i.select(),a=i.dataItem(t);a?document.getElementById("value-item").value=a.id:e("#log").text("Nothing selected")})}}).fail(o.exception)}),e("#save-add").click(function(){var t=e("#value-item").val(),o=e("#ordernumber").val(),i=e("#orgstructure_position").val();if(t){var n=a.wwwroot+"/local/newsvnr/ajax.php";e.ajax({url:n,method:"POST",data:{action:"add",comp_id:t,ordernumber:o,orgstructure_position:i},success:function(t){var a=JSON.parse(t);"0"==a?alert("Năng lực này đã tồn tại"):(e(".orgcomp-position .table tbody").append(a.html),e(".orgcomp-position .group-modal").append(a.modal),alert("Thêm thành công!"))}})}else alert("Dữ liệu trống!")}),e("#orgstructure").change(function(){var t=e(this).val();if(""!=t){var o=a.wwwroot+"/local/newsvnr/ajax.php";e.ajax({url:o,method:"GET",data:{action:"get_orgstruct_position",org_struct:t},success:function(t){e("#orgstructure_position").html(t)}})}e("#add_competency").prop("disabled",!0)}),e("#orgstructure_position").change(function(){var t=e(this).val(),o=a.wwwroot+"/local/newsvnr/ajax.php";null!=t&&(e("#add_competency").prop("disabled",!1),e.ajax({url:o,method:"GET",data:{action:"load_comp_postion",org_struct_position:t},success:function(t){var a=JSON.parse(t);1!=a.check_exist_comp_template?e("#add_planning").prop("disabled",!0):1==a.check_exist_position_template?e("#add_planning").prop("disabled",!0):e("#add_planning").prop("disabled",!1),e('[data-region="orgcomp-position"]').html(a.comp_table),e('[data-region="orgcomp-plan"]').html(a.plan_table),e(".orgcomp-position .group-modal").html(a.modal),e.fn.dataTable.isDataTable("#orgcomp-position")?e("#orgcomp-position").DataTable():e("#orgcomp-position").DataTable({scrollX:!0}),e.fn.dataTable.isDataTable("#orgcomp-plan ")?e("#orgcomp-plan").DataTable():e("#orgcomp-plan").DataTable({})}}))}),e(function(){var t=[];checkTimeOut=!1;for(var a=0;a<=24;a++)a<10?t.push('<option value="0'+a+'">0'+a+"</option"):t.push('<option value="'+a+'">'+a+"</option");var o=[];for(a=0;a<60;a++)a<10?o.push('<option value="0'+a+'">0'+a+"</option"):o.push('<option value="'+a+'">'+a+"</option");e("#hour").html(t),e("#minute").html(o),e("#show-timeout").click(function(){e("#time-out").show(),checkTimeOut=!0}),e("#hidden-timeout").click(function(){e("#time-out").hide(),checkTimeOut=!1})}),e("#save-planning").click(function(){var t=e("#name").val(),a=e("#descript").val(),o=e("#visible").val(),i=""!=e("#date-picker-2").val()?e("#date-picker-2").val():0,n=e("#hour").val()+":"+e("#minute").val();if(1==checkTimeOut)var r=new Date(i+" "+n).getTime()/1e3;else r=0;var c=e("#orgstructure_position").val(),l=e("#userid").val();if(""==t)alert("Name không được bỏ trống");else{var p=location.origin+"/local/newsvnr/ajax.php";e.ajax({url:p,method:"POST",data:{action:"save-planning",name:t,descript:a,visible:o,userid:l,getDateTime:r,orgstructure_position:c},success:function(t){1==t&&(alert("Thêm kế hoạch thành công!"),e("#name").val(""),e("#descript").val(""),e("#myModal1").modal("hide"),e("#add_planning").prop("disabled",!0))}})}}),e(".list-group li").click(function(){e(this).addClass("active").siblings().removeClass("active")})}}});