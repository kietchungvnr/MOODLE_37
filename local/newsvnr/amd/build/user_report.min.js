define(["jquery","core/config","validatefm","local_newsvnr/initkendogrid","alertjs","core/str","kendo.all.min","local_newsvnr/initkendocontrolservices"],function(e,t,r,o,i,a,n,s){"use strict";let c="#user_report",l={},u=t.wwwroot+"/local/newsvnr/report/ajax/userreport.php",d=t.wwwroot+"/local/newsvnr/report/ajax/userreport_action.php";var p=function(t){var r={url:u,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",data:t},i=[{template:function(e){return e.name},field:"name",title:M.util.get_string("nameuser","local_newsvnr"),width:"130px"},{field:"shortname",title:M.util.get_string("codeuser","local_newsvnr"),width:"100px"},{field:"email",title:M.util.get_string("email","local_newsvnr"),width:"130px"},{field:"timecreated",title:M.util.get_string("createdtime","local_newsvnr"),width:"120px"},{field:"timeaccess",title:M.util.get_string("timeaccess","local_newsvnr"),width:"100px"},{field:"lastaccess",title:M.util.get_string("lastaccess","local_newsvnr"),width:"100px"}];l.onChange=function(){e.map(this.select(),function(t){return e(t).text()}).length>0?e(".user-report-fuction").removeClass("disabled"):e(".user-report-fuction").addClass("disabled")},l.toolbar=["excel"],l.excel={fileName:"userreport.xlsx",allPages:!0},l.columns=i,l.apiSettings=r,l.deleteUserEvent=function(t){e(c).data("kendoGrid").dataSource.read()},l.hideUserEvent=function(t){e(c).data("kendoGrid").dataSource.read()},l.showUserEvent=function(t){e(c).data("kendoGrid").dataSource.read()},l.editUserEvent=function(e){};var a=o.initGrid(l);e(c).data("kendoGrid")&&e(c).data("kendoGrid").destroy(),e(".user-report-fuction").addClass("disabled"),e(c).kendoGrid(a)};return{init:function(){p(),e("#searchaccount").click(function(){!function(e,t,r,o,i,a){p({action:"searchaccount",username:e,useremail:t,usercode:r,userstatus:o,notaccess:i,notmodify:a})}(e("#username").val(),e("#useremail").val(),e("#usercode").val(),e("#userstatus").val(),e("#isnotaccess").is(":checked"),e("#isnotmodify").is(":checked"))}),e("#searchorgs").click(function(){!function(e,t){p({action:"searchorgstructure",orgstructureid:e,positionid:t})}(e("#orgstructure").val(),e("#orgstructure_position").val())}),e("#searchadvance").click(function(){var t=e("#system_role").val(),r=e("#course_role").val(),o=e("#list_course").val(),i=e("#start_timeaccess").val(),a=parseInt((new Date(i).getTime()/1e3).toFixed(0)),n=e("#end_timeaccess").val();!function(e,t,r,o,i){p({action:"searchadvance",systemroleid:e,courseroleid:t,courseid:r,datestart:o,dateend:i})}(t,r,o,a,parseInt((new Date(n).getTime()/1e3).toFixed(0)))}),e("#resettable").click(function(){p()}),e("#exporttable").click(function(){e(".k-grid-excel").click()})},deleteUser:function(){e("#btn-user-delete").click(function(){var t=getSelectRow("#user_report"),r={type:"POST",processData:!0,data:{dataselect:JSON.stringify(t),action:"deleteselected"}};e.ajax(d,r).then(function(t){var r=e.parseJSON(t);i.notify(r.result,"success",3),e(c).data("kendoGrid").dataSource.read(),e(".user-report-fuction").addClass("disabled")})})},openPopUp:function(){e(".user-report-fuction").click(function(){var t=e(this).attr("data-href");if(null!=t){var r=e(this).text(),o=getSelectRow("#user_report"),i={type:"POST",processData:!0,data:{dataselect:JSON.stringify(o),action:"addsession"}};e.ajax(d,i).then(function(o){setCookie("cookie","focusmod");var i='<iframe id="iframe-edit-category" src="'+t+'" width="100%" height="600px" style="border:0"></iframe>';e("#popup-user-report .modal-title").text(r),e("#popup-user-report .modal-body").html(i)})}})},kendoDropdown:function(){var t="/local/newsvnr/report/ajax/userreport_data.php?action=";(l={}).apiSettings={url:t+"get_userstatus"},l.value="value",l.optionLabel="Chọn trạng thái";var r=s.initDropDownList(l);e("#userstatus").kendoDropDownList(r),(l={}).apiSettings={url:t+"get_orgstructure_category"},l.value="categoryid",l.optionLabel="Chọn loại phòng ban";var o=s.initDropDownList(l);e("#orgstructure_category").kendoDropDownList(o),(l={}).apiSettings={url:t+"get_orgstructure"},l.value="orgid",l.optionLabel="Chọn phòng ban",l.cascadeFrom="orgstructure_category";var i=s.initDropDownList(l);e("#orgstructure").kendoDropDownList(i),(l={}).apiSettings={url:t+"get_orgstructure_jobtitle"},l.value="jobtitleid",l.optionLabel="Chọn chức danh";var a=s.initDropDownList(l);e("#orgstructure_jobtitle").kendoDropDownList(a),(l={}).apiSettings={url:t+"get_orgstructure_position"},l.value="positionid",l.optionLabel="Chọn chức vụ",l.cascadeFrom="orgstructure_jobtitle";var n=s.initDropDownList(l);e("#orgstructure_position").kendoDropDownList(n),(l={}).apiSettings={url:t+"get_system_role"},l.value="value",l.optionLabel="Chọn vai trò";var c=s.initDropDownList(l);e("#system_role").kendoDropDownList(c),(l={}).apiSettings={url:t+"get_course_role"},l.value="value",l.optionLabel="Chọn chức danh";var l,u=s.initDropDownList(l);e("#course_role").kendoDropDownList(u),(l={}).apiSettings={url:t+"get_course"},l.value="id",l.optionLabel="Chọn khóa học";var d=s.initDropDownList(l);e("#list_course").kendoDropDownList(d),e("#start_timeaccess").kendoDatePicker({change:function(){e("#end_timeaccess").val("");var t=e("#start_timeaccess").val().split("/");if(t.length>1){var r=e("#end_timeaccess").data("kendoDatePicker"),o=parseInt(t[2]),i=parseInt(t[0]),a=parseInt(t[1]);r.setOptions({min:new Date(o,i-1,a+1)})}}}),e("#end_timeaccess").kendoDatePicker()}}});