define(["jquery","core/config","validatefm","local_newsvnr/initkendogrid","alertjs","core/str","kendo.all.min","local_newsvnr/initkendocontrolservices"],function(e,t,r,i,o,a,s,n){"use strict";let l="#user_report",c={},u=t.wwwroot+"/local/newsvnr/report/ajax/userreport.php",d=t.wwwroot+"/local/newsvnr/report/ajax/userreport_action.php";setCookie("cookie","focusmod"),setCookie("spa","true");var p=function(t){var r={url:u,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",data:t},o=[{template:function(e){return e.useravatar+"<a href='"+e.href+"' target='_blank'>"+e.name+"</a>"},field:"name",title:M.util.get_string("studentname","local_newsvnr"),width:"130px"},{field:"shortname",title:M.util.get_string("codeuser","local_newsvnr"),width:"100px"},{field:"username",title:M.util.get_string("username_login","local_newsvnr"),width:"100px"},{field:"email",title:M.util.get_string("email","local_newsvnr"),width:"130px"},{field:"timecreated",title:M.util.get_string("createdtime","local_newsvnr"),width:"120px"},{field:"timeaccess",title:M.util.get_string("timeaccess","local_newsvnr"),width:"100px"},{field:"lastaccess",title:M.util.get_string("lastaccess","local_newsvnr"),width:"100px"}];c.onChange=function(){e.map(this.select(),function(t){return e(t).text()}).length>0?e(".user-report-fuction").removeClass("disabled"):e(".user-report-fuction").addClass("disabled")},c.toolbar=["excel"],c.excel={fileName:"userreport.xlsx",allPages:!0},c.columns=o,c.apiSettings=r,c.deleteUserEvent=function(t){e(l).data("kendoGrid").dataSource.read()},c.hideUserEvent=function(t){e(l).data("kendoGrid").dataSource.read()},c.showUserEvent=function(t){e(l).data("kendoGrid").dataSource.read()},c.editUserEvent=function(e){};var a=i.initGrid(c);e(l).data("kendoGrid")&&e(l).data("kendoGrid").destroy(),e(".user-report-fuction").addClass("disabled"),e(l).kendoGrid(a)};return{init:function(){p(),e("#searchaccount").click(function(){!function(e,t,r,i,o,a){p({action:"searchaccount",username:e,useremail:t,usercode:r,userstatus:i,notaccess:o,notmodify:a})}(e("#username").val(),e("#useremail").val(),e("#usercode").val(),e("#userstatus").val(),e("#isnotaccess").is(":checked"),e("#isnotmodify").is(":checked"))}),e("#searchorgs").click(function(){!function(e,t){p({action:"searchorgstructure",orgstructureid:e,positionid:t})}(e("#orgstructure").val(),e("#orgstructure_position").val())}),e("#searchadvance").click(function(){var t=e("#system_role").val(),r=e("#course_role").val(),i=e("#list_course").val(),o=e("#start_timeaccess").val(),a=parseInt((new Date(o).getTime()/1e3).toFixed(0)),s=e("#end_timeaccess").val();!function(e,t,r,i,o){p({action:"searchadvance",systemroleid:e,courseroleid:t,courseid:r,datestart:i,dateend:o})}(t,r,i,a,parseInt((new Date(s).getTime()/1e3).toFixed(0)))}),e("#resettable").click(function(){p()}),e("#exporttable").click(function(){e(".k-grid-excel").click()})},deleteUser:function(){e("#btn-user-delete").click(function(){var t=getSelectRow("#user_report"),r={type:"POST",processData:!0,data:{dataselect:JSON.stringify(t),action:"deleteselected"}};e.ajax(d,r).then(function(t){var r=e.parseJSON(t);o.notify(r.result,"success",3),e(l).data("kendoGrid").dataSource.read(),e(".user-report-fuction").addClass("disabled")})})},openPopUp:function(){e(".user-report-fuction").click(function(){var t=e(this).attr("data-href");if(null!=t){var r=e(this).text(),i=getSelectRow("#user_report"),o={type:"POST",processData:!0,data:{dataselect:JSON.stringify(i),action:"addsession"}};e.ajax(d,o).then(function(i){var o='<iframe id="iframe-edit-category" src="'+t+'" width="100%" height="600px" style="border:0"></iframe>';e("#popup-user-report .modal-title").text(r),e("#popup-user-report .modal-body").html(o),e("#iframe-edit-category").on("load",function(){iFrameResize({log:!1},"#iframe-edit-category")})})}})},kendoDropdown:function(){var t="/local/newsvnr/report/ajax/report_data.php?action=";(c={}).apiSettings={url:t+"get_userstatus"},c.value="value",c.optionLabel=M.util.get_string("selectstatus","local_newsvnr");var r=n.initDropDownList(c);e("#userstatus").kendoDropDownList(r),(c={}).apiSettings={url:t+"get_orgstructure_category"},c.value="categoryid",c.optionLabel=M.util.get_string("selectorgstructuretype","local_newsvnr");var i=n.initDropDownList(c);e("#orgstructure_category").kendoDropDownList(i),(c={}).apiSettings={url:t+"get_orgstructure"},c.value="orgid",c.optionLabel=M.util.get_string("selectorgstructure","local_newsvnr"),c.cascadeFrom="orgstructure_category";var o=n.initDropDownList(c);e("#orgstructure").kendoDropDownList(o),(c={}).apiSettings={url:t+"get_orgstructure_jobtitle"},c.value="jobtitleid",c.optionLabel=M.util.get_string("selectjobtitle","local_newsvnr");var a=n.initDropDownList(c);e("#orgstructure_jobtitle").kendoDropDownList(a),(c={}).apiSettings={url:t+"get_orgstructure_position"},c.value="positionid",c.optionLabel=M.util.get_string("selectjobposition","local_newsvnr"),c.cascadeFrom="orgstructure_jobtitle";var s=n.initDropDownList(c);e("#orgstructure_position").kendoDropDownList(s),(c={}).apiSettings={url:t+"get_system_role"},c.value="value",c.optionLabel=M.util.get_string("selectrole","local_newsvnr");var l=n.initDropDownList(c);e("#system_role").kendoDropDownList(l),(c={}).apiSettings={url:t+"get_course_role"},c.value="value",c.optionLabel=M.util.get_string("selectrole","local_newsvnr");var c,u=n.initDropDownList(c);e("#course_role").kendoDropDownList(u),(c={}).apiSettings={url:t+"get_course"},c.value="id",c.optionLabel=M.util.get_string("selectcourse","local_newsvnr");var d=n.initDropDownList(c);e("#list_course").kendoDropDownList(d),e("#start_timeaccess").kendoDatePicker({change:function(){e("#end_timeaccess").val("");var t=e("#start_timeaccess").val().split("/");if(t.length>1){var r=e("#end_timeaccess").data("kendoDatePicker"),i=parseInt(t[2]),o=parseInt(t[0]),a=parseInt(t[1]);r.setOptions({min:new Date(i,o-1,a+1)})}}}),e("#end_timeaccess").kendoDatePicker()}}});