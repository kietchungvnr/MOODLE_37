define(["jquery","core/config","validatefm","local_newsvnr/initkendogrid","alertjs","core/str","kendo.all.min","local_newsvnr/initkendocontrolservices"],function(t,e,n,r,o,i,l,a){"use strict";let s="#competency_report",c={},u=e.wwwroot+"/local/newsvnr/report/ajax/competency_report.php";var p=function(e){var n={url:u,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",data:e},o=[{template:function(t){return t.useravatar+"<a href='"+t.userhref+"' target='_blank'>"+t.name+"</a>"},field:"name",title:M.util.get_string("studentname","local_newsvnr"),width:"100px"},{field:"competencyname",title:M.util.get_string("competency","local_newsvnr"),width:"100px"},{template:function(t){return t.activity},field:"activity",title:M.util.get_string("activeresource","local_newsvnr"),width:"100px"},{template:function(t){return"<a href='"+t.coursehref+"' target='_blank'>"+t.coursename+"</a>"},field:"coursename",title:M.util.get_string("course","local_newsvnr"),width:"130px"},{field:"planname",title:M.util.get_string("learningplan","local_newsvnr"),width:"100px"},{template:function(t){return"<span class='badge text-white "+t.classstatus+"  font-weight-bold rounded p-2'>"+t.status+"</span>"},field:"status",title:M.util.get_string("status","local_newsvnr"),width:"90px"},{field:"timecompleted",title:M.util.get_string("timefinishcourse","local_newsvnr"),width:"80px"},{field:"reviewer",title:M.util.get_string("reviewer","local_newsvnr"),width:"100px"}];c.onChange=function(){t.map(this.select(),function(e){return t(e).text()}).length>0?t("#exporttable").addClass("action"):t("#exporttable").removeClass("action")},c.toolbar=["excel"],c.excel={fileName:"Report.xlsx",allPages:!0},c.columns=o,c.apiSettings=n;var i=r.initGrid(c);t(s).data("kendoGrid")&&t(s).data("kendoGrid").destroy(),t(s).kendoGrid(i)};return{init:function(){p(),t("#searchorgs").click(function(){!function(t,e){p({action:"searchorgstructure",orgstructureid:t,positionid:e})}(t("#orgstructure").val(),t("#orgstructure_position").val())}),t("#searchaccount").click(function(){!function(t,e,n,r){p({action:"searchaccount",username:t,competency:e,competencyplan:n,course:r})}(t("#username").val(),t("#competency").val(),t("#competencyplan").val(),t("#course").val())}),t("#resettable").click(function(){p()}),t("#exporttable").on("click",function(e){var n=t("#competency_report").find("tr");if(t(n).find(":checkbox").is(":checked")){var r=[{cells:[{value:M.util.get_string("studentname","local_newsvnr")},{value:M.util.get_string("competency","local_newsvnr")},{value:M.util.get_string("course","local_newsvnr")},{value:M.util.get_string("learningplan","local_newsvnr")},{value:M.util.get_string("status","local_newsvnr")},{value:M.util.get_string("timefinishcourse","local_newsvnr")},{value:M.util.get_string("reviewer","local_newsvnr")}]}];exportExcelKendo("#competency_report",r)}else t(".k-grid-excel").click()})},kendoDropdown:function(){var e="/local/newsvnr/report/ajax/report_data.php?action=";(l={}).apiSettings={url:e+"get_competency"},l.value="value",l.optionLabel=M.util.get_string("selectcompetency","local_newsvnr");var n=a.initDropDownList(l);t("#competency").kendoDropDownList(n),(l={}).apiSettings={url:e+"get_competencyplan"},l.value="value",l.optionLabel=M.util.get_string("selectplan","local_newsvnr");n=a.initDropDownList(l);t("#competencyplan").kendoDropDownList(n),(l={}).apiSettings={url:e+"get_course"},l.value="value",l.optionLabel=M.util.get_string("selectcourse","local_newsvnr");n=a.initDropDownList(l);t("#course").kendoDropDownList(n),(l={}).apiSettings={url:e+"get_orgstructure_category"},l.value="categoryid",l.optionLabel=M.util.get_string("selectorgstructuretype","local_newsvnr");var r=a.initDropDownList(l);t("#orgstructure_category").kendoDropDownList(r),(l={}).apiSettings={url:e+"get_orgstructure"},l.value="orgid",l.optionLabel=M.util.get_string("selectorgstructure","local_newsvnr"),l.cascadeFrom="orgstructure_category";var o=a.initDropDownList(l);t("#orgstructure").kendoDropDownList(o),(l={}).apiSettings={url:e+"get_orgstructure_jobtitle"},l.value="jobtitleid",l.optionLabel=M.util.get_string("selectjobtitle","local_newsvnr");var i=a.initDropDownList(l);t("#orgstructure_jobtitle").kendoDropDownList(i),(l={}).apiSettings={url:e+"get_orgstructure_position"},l.value="positionid",l.optionLabel=M.util.get_string("selectjobposition","local_newsvnr"),l.cascadeFrom="orgstructure_jobtitle";var l,s=a.initDropDownList(l);t("#orgstructure_position").kendoDropDownList(s),(l={}).apiSettings={url:e+"get_report"},l.value="value",l.optionLabel=M.util.get_string("selectreport","local_newsvnr");var c=a.initDropDownList(l);t("#report").kendoDropDownList(c)}}});