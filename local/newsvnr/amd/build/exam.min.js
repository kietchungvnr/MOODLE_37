define(["jquery","core/config","validatefm","local_newsvnr/initkendoexam","alertjs","core/str","kendo.all.min"],function(e,t,a,n,i,r,l){"use strict";var s=t.wwwroot+"/local/newsvnr/exam/ajax/exam.php",o=t.wwwroot+"/local/newsvnr/exam/ajax/exam_view.php",d="",c="",u=!0;function m(t){for(var a=e(t).getKendoGrid(),n=a.select(),i=[],r=0;r<n.length;r++)i.push(a.dataItem(n[r]));return i}function x(e){var t=new Date(e).toUTCString();return new Date(t).getTime()/1e3}var p=function(e){return new l.data.DataSource({transport:{read:e,parameterMap:function(e,t){if("read"==t)return e.filter&&e.filter.filters[0]&&(e.q=e.filter.filters[0].value),e}},schema:{model:{fields:{id:{type:"number"},fullname:{type:"string"}}}},pageSize:30,serverPaging:!0,serverFiltering:!0})},g=function(t,a){if(null==t.getKendoForm()){t.kendoForm({orientation:"vertical",formData:{sxid:"",sxname:"",sxcode:"",sxshortname:"",sxdescription:"",sxvisible:!0},buttonsTemplate:'<button class="k-button k-primary k-form-submit" type="submit" data-action="subjectexam_add">'+M.util.get_string("addnew","local_newsvnr")+'</button><button class="k-button k-form-clear">'+M.util.get_string("clear","local_newsvnr")+"</button>",items:[{field:"sxname",label:M.util.get_string("name","local_newsvnr"),validation:{}},{field:"sxcode",label:{text:M.util.get_string("code","local_newsvnr")},validation:{}},{field:"sxshortname",label:M.util.get_string("shortname","local_newsvnr"),validation:{}},{field:"sxdescription",label:M.util.get_string("description","local_newsvnr"),editor:function(t,a){e("<textarea class='k-textarea' id='"+a.field+"' name='"+a.field+"' data-bind='value: "+a.field+"'></textarea>").appendTo(t)}},{field:"sxvisible",label:M.util.get_string("examvisible","local_newsvnr"),editor:"Switch"}],submit:function(a){if(l.ui.progress(e("#modal-subjectexam"),!0),a.preventDefault(),t.kendoValidator({rules:{ruleRequired:function(t){return!!t.is("[name=sxdescription]")||""!==e.trim(t.val())}},messages:{ruleRequired:M.util.get_string("fieldrequired","local_newsvnr")}}).data("kendoValidator").validate()){var n={type:"GET",dataType:"json",contentType:"application/json",data:{action:e("#form-subjectexam .k-form-submit").attr("data-action"),exam:a.model}};e.ajax(s,n).then(function(t){t.success&&(e("#subjectexam-grid").data("kendoGrid").dataSource.read(),"subjectexam_add"==n.data.action&&(e("#sxname").val(""),e("#sxcode").val(""),e("#sxshortname").val(""),e("#sxdescription").val(""),e("#sxvisible").data("kendoSwitch").value(!0)),i.success(t.success,"success",3),l.ui.progress(e("#modal-subjectexam"),!1))})}else a.preventDefault(),l.ui.progress(e("#modal-subjectexam"),!1)}})}else"subjectexam_add"==a?t.getKendoForm().setOptions({buttonsTemplate:'<button class="k-button k-primary k-form-submit" type="submit" data-action="subjectexam_add">'+M.util.get_string("addnew","local_newsvnr")+'</button><button class="k-button k-form-clear">'+M.util.get_string("clear","local_newsvnr")+"</button>"}):"subjectexam_edit"==a&&t.getKendoForm().setOptions({buttonsTemplate:'<button class="k-button k-primary k-form-submit" type="submit" data-action="subjectexam_edit">'+M.util.get_string("edit","local_newsvnr")+'</button><button class="k-button k-form-clear">'+M.util.get_string("clear","local_newsvnr")+"</button>"})},v=function(t,a){function n(){e("#examname").val(""),e("#examcode").val(""),e("#subjectexam").data("kendoMultiSelect").value([]),e("#examdatestart").data("kendoDateTimePicker").value(new Date),e("#examdateend").data("kendoDateTimePicker").value(new Date),e("#examdescription").val(""),e("#examvisible").data("kendoSwitch").value(!0)}if(null==t.getKendoForm()){var r={url:s,type:"GET",dataType:"json",data:{action:"list_subjectexam"}};t.kendoForm({orientation:"vertical",formData:{examid:"",examname:"",examcode:"",examtype:0,examdatestart:new Date,examdateend:new Date,examdescription:"",examvisible:!0},buttonsTemplate:'<button class="k-button k-primary k-form-submit" type="submit" data-action="exam_add">'+M.util.get_string("addnew","local_newsvnr")+'</button><button class="k-button k-form-clear">'+M.util.get_string("clear","local_newsvnr")+"</button>",items:[{field:"examtype",label:M.util.get_string("examtype","local_newsvnr"),validation:{required:!0},editor:"DropDownList",editorOptions:{optionLabel:M.util.get_string("selectexamtype","local_newsvnr"),dataSource:[{text:M.util.get_string("required","local_newsvnr"),value:0},{text:M.util.get_string("free","local_newsvnr"),value:1}],dataTextField:"text",dataValueField:"value"}},{field:"examname",label:M.util.get_string("name","local_newsvnr"),validation:{}},{field:"examcode",label:M.util.get_string("code","local_newsvnr"),validation:{}},{field:"subjectexam",label:M.util.get_string("subjectexam","local_newsvnr"),validation:{required:!0},editor:"MultiSelect",editorOptions:{placeholder:M.util.get_string("selectsubjectexam","local_newsvnr"),itemTemplate:"<span>#= code # - #= name #</span>",dataTextField:"name",dataValueField:"id",height:520,dataSource:{transport:{read:r,parameterMap:function(e,t){if("read"==t)return e.filter&&e.filter.filters[0]&&(e.q=e.filter.filters[0].value),e}},schema:{model:{fields:{id:{type:"number"},name:{type:"string"},code:{type:"string"}}}},pageSize:30,serverPaging:!0,serverFiltering:!0}}},{field:"examdatestart",label:M.util.get_string("examdatestart","local_newsvnr"),editor:"DateTimePicker",validation:{required:!0},editorOptions:{format:"dd/MM/yyyy hh:mm tt"}},{field:"examdateend",label:M.util.get_string("examdateend","local_newsvnr"),editor:"DateTimePicker",validation:{required:!0},editorOptions:{format:"dd/MM/yyyy hh:mm tt"}},{field:"examdescription",label:M.util.get_string("description","local_newsvnr"),editor:function(t,a){e("<textarea class='k-textarea' id='"+a.field+"' name='"+a.field+"' data-bind='value: "+a.field+"'></textarea>").appendTo(t)}},{field:"examvisible",label:M.util.get_string("examvisible","local_newsvnr"),editor:"Switch"}],submit:function(a){if(l.ui.progress(e("#modal-exam"),!0),a.preventDefault(),t.kendoValidator({rules:{ruleRequired:function(t){return!(!t.is("[name=examdescription]")&&!t.is("[title=subjectexam]"))||""!==e.trim(t.val())},checkDateStart:function(t){if(t.is("[name=examdatestart]")){var a=x(e("[name=examdatestart]").data("kendoDateTimePicker").value()),n=x(new Date);return!(a<=n-120)}return!0},checkDateEnd:function(t){if(t.is("[name=examdateend]")){var a=x(e("[name=examdatestart]").data("kendoDateTimePicker").value()),n=x(e("[name=examdateend]").data("kendoDateTimePicker").value());return!(n<a)}return!0}},messages:{ruleRequired:M.util.get_string("fieldrequired","local_newsvnr"),checkDateStart:M.util.get_string("checkdatestart","local_newsvnr"),checkDateEnd:M.util.get_string("checkdateend","local_newsvnr")}}).data("kendoValidator").validate()){a.model.examdatestart&&(a.model.examdatestart=x(a.model.examdatestart)),a.model.examdateend&&(a.model.examdateend=x(a.model.examdateend)),a.model.subjectexam&&(a.model.subjectexam=e("#subjectexam").data("kendoMultiSelect").value().toString()),a.model.examtype&&(a.model.examtype=e("#examtype").data("kendoDropDownList").value());var r={type:"GET",dataType:"json",contentType:"application/json",data:{action:e("#form-exam .k-form-submit").attr("data-action"),exam:a.model}};e.ajax(s,r).then(function(t){if(t.success){var a=e("#exam-grid").data("kendoGrid");null!=a&&(a.dataSource.read(),"exam_add"==r.data.action&&n()),i.success(t.success,"success",3),l.ui.progress(e("#modal-exam"),!1)}})}else a.preventDefault(),l.ui.progress(e("#modal-exam"),!1)}})}else"exam_add"==a?(t.getKendoForm().setOptions({buttonsTemplate:'<button class="k-button k-primary k-form-submit" type="submit" data-action="exam_add">'+M.util.get_string("addnew","local_newsvnr")+'</button><button class="k-button k-form-clear">'+M.util.get_string("clear","local_newsvnr")+"</button>"}),n()):"exam_edit"==a&&(t.getKendoForm().setOptions({buttonsTemplate:'<button class="k-button k-primary k-form-submit" type="submit" data-action="exam_edit">'+M.util.get_string("edit","local_newsvnr")+'</button><button class="k-button k-form-clear">'+M.util.get_string("clear","local_newsvnr")+"</button>"}),n())},f=function(t,a){if(!t.getKendoForm()){var n={url:s,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",data:{action:"list_users",examid:a.id}},r={url:s,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",data:{action:"list_cohort"}};t.kendoForm({formData:{examid:a.id,examusers:"",examcohort:"",examusersrole:5},operation:"vertical",buttonsTemplate:'<button class="k-button k-primary k-form-submit" type="submit">'+M.util.get_string("enrol","local_newsvnr")+'</button><button class="k-button k-form-clear">'+M.util.get_string("clear","local_newsvnr")+"</button>",items:[{field:"examusers",label:M.util.get_string("examuserfullname","local_newsvnr"),editor:"MultiSelect",editorOptions:{placeholder:M.util.get_string("selectusers","local_newsvnr"),itemTemplate:"<span>#= fullname #</span>",dataTextField:"fullname",dataValueField:"id",dataSource:p(n)}},{field:"examcohort",label:M.util.get_string("cohort","local_newsvnr"),editor:"MultiSelect",editorOptions:{placeholder:M.util.get_string("selectcohort","local_newsvnr"),itemTemplate:"<span>#= fullname #</span>",dataTextField:"fullname",dataValueField:"id",dataSource:p(r)}},{field:"examusersrole",label:M.util.get_string("role","local_newsvnr"),editor:"DropDownList",validation:{required:!0},editorOptions:{dataSource:[{text:M.util.get_string("studentrole","local_newsvnr"),value:5},{text:M.util.get_string("teacherrole","local_newsvnr"),value:4}],dataTextField:"text",dataValueField:"value"}}],submit:function(t){t.preventDefault(),l.ui.progress(e("#modal-enrollexamusers"),!0),t.model.examusers=e("#examusers").data("kendoMultiSelect").value().toString(),t.model.examcohort=e("#examcohort").data("kendoMultiSelect").value().toString(),t.model.examusersrole&&(t.model.examusersrole=e("#examusersrole").data("kendoDropDownList").value());var a={type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",data:{action:"examusers_enroll",exam:t.model}};e.ajax(s,a).then(function(t){if(t.success){var a=e("#enrollexamusers-grid").data("kendoGrid"),n=e("#exam-users-grid").data("kendoGrid");a.dataSource.read(),null!=n&&n.dataSource.read(),e("#examusers").data("kendoMultiSelect").value(""),e("#examcohort").data("kendoMultiSelect").value(""),e("#examusers").data("kendoMultiSelect").dataSource.read(),i.success(t.success,"success",3),l.ui.progress(e("#modal-enrollexamusers"),!1)}})}})}},_=function(t){if(null==t.getKendoForm())t.kendoForm({orientation:"vertical",formData:{enrolluserid:"",examid:"",examuserid:"",examuserfullname:"",examusersrole:5},buttonsTemplate:'<button class="k-button k-primary k-form-submit" type="submit">'+M.util.get_string("edit","local_newsvnr")+'</button><button class="k-button k-form-clear">'+M.util.get_string("clear","local_newsvnr")+"</button>",items:[{field:"examuserfullname",label:M.util.get_string("examuserfullname","local_newsvnr"),validation:{required:!0},attributes:{enable:!1}},{field:"examusersrole",label:M.util.get_string("role","local_newsvnr"),validation:{required:!0},editor:"DropDownList",editorOptions:{dataSource:[{text:M.util.get_string("studentrole","local_newsvnr"),value:5},{text:M.util.get_string("teacherrole","local_newsvnr"),value:4}],dataTextField:"text",dataValueField:"value"}}],submit:function(t){l.ui.progress(e("#modal-enrollexamusers-edit"),!0),t.preventDefault(),t.model.examtype&&(t.model.examtype=e("#examusersrole").data("kendoDropDownList").value());var a={type:"GET",dataType:"json",contentType:"application/json",data:{action:"examusers_enroll_edit",exam:t.model}};e.ajax(s,a).then(function(t){if(t.success){var a=e("#enrollexamusers-grid").data("kendoGrid"),n=e("#exam-users-grid").data("kendoGrid");a.dataSource.read(),null!=n&&n.dataSource.read(),i.success(t.success,"success",3),l.ui.progress(e("#modal-enrollexamusers-edit"),!1)}})}})},b=function(){var t=e("#form-exam"),a=e("#modal-exam"),n=e("#btn-exam");n.click(function(){a.data("kendoWindow").open()}),a.kendoWindow({width:"450px",title:M.util.get_string("createexam","local_newsvnr"),modal:!0,close:function(){c="exam_add",n.fadeIn()},open:function(e){v(t,c),e.sender.center()}}),a.data("kendoWindow").close()},w=function(t){var a={},r={url:s,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",data:{action:"examusers_grid",examid:t.id}},l=[{field:"examname",title:M.util.get_string("name","local_newsvnr"),width:"200px"},{template:function(e){return e.fullname},field:"fullname",title:M.util.get_string("examuserfullname","local_newsvnr"),width:"200px"},{field:"rolename",title:M.util.get_string("role","local_newsvnr"),width:"200px"},{field:"usercreate",title:M.util.get_string("usercreate","local_newsvnr"),width:"200px"}];a.columns=l,a.apiSettings=r,a.toolbar=[{template:'<a class="btn btn-secondary" id="btn-enrollexamusers-delete" href="javascript:;"><i class="fa fa-trash-o mr-2" aria-hidden="true"></i>'+M.util.get_string("deleteall","local_newsvnr")+"</a>"},"search"],a.editEvent=function(a){var n=e("#modal-enrollexamusers-edit"),i=e("#form-enrollexamusers-edit");y(i,n),i.getKendoForm().setOptions({formData:{enrolluserid:a.id,examid:t.id,examuserid:a.userid,examuserfullname:a.fullname_raw,examusersrole:a.roleid}}),n.data("kendoWindow").open()},a.deleteEvent=function(t){var a={type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",data:{action:"examusers_enroll_delete",id:t.id}};e.ajax(s,a).then(function(t){if(t.success){var a=e("#enrollexamusers-grid").data("kendoGrid"),n=e("#exam-users-grid").data("kendoGrid");a.dataSource.read(),null!=n&&n.dataSource.read()}})};var o=n.initGrid(a);e("#enrollexamusers-grid").data("kendoGrid")&&e("#enrollexamusers-grid").data("kendoGrid").destroy(),e("#enrollexamusers-grid").kendoGrid(o),1==u&&(e("#btn-enrollexamusers-delete").click(function(){var t=m("#enrollexamusers-grid");if(t.length>0){var a={type:"POST",processData:!0,data:{action:"enrolexamusers_delete_all",rowselected:JSON.stringify(t)}};e.ajax(s,a).then(function(t){(t=JSON.parse(t)).success&&(e("#enrollexamusers-grid").data("kendoGrid").dataSource.read(),i.success(t.success,"success",3))})}else i.error(M.util.get_string("error_norowselectd","local_newsvnr"),"error",3)}),u=!1)},y=function(e,t){t.kendoWindow({width:"768px",title:M.util.get_string("editenrollexamuser","local_newsvnr"),modal:!0,open:function(t){_(e),t.sender.center()}}),t.data("kendoWindow").close()},h=function(t){var a={},i={url:o,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",data:{action:"exam_listusersexam_grid",examid:t}},r=[{template:function(e){return e.fullname},field:"fullname",title:M.util.get_string("examuserfullname","local_newsvnr"),width:"200px"},{field:"email",title:M.util.get_string("email","local_newsvnr"),width:"200px"},{field:"enrolltime",title:M.util.get_string("enrolltime","local_newsvnr"),width:"200px"}];a.columns=r,a.toolbar=[{template:'<a class="btn btn-secondary" id="btn-enrollexamusers" href="javascript:;"><i class="fa fa-user-plus mr-2" aria-hidden="true"></i>'+M.util.get_string("enrol","local_newsvnr")+"</a>"},"search"],a.apiSettings=i;var l=n.initGrid(a);e("#exam-users-grid").data("kendoGrid")&&e("#exam-users-grid").data("kendoGrid").destroy(),e("#exam-users-grid").kendoGrid(l)};return{initExamSubject:function(){var t={};!function(){e("#validation-success");var t=e("#form-subjectexam"),a=e("#modal-subjectexam"),n=e("#btn-subjectexam");n.click(function(){a.data("kendoWindow").open(),e("#sxname").val(""),e("#sxcode").val(""),e("#sxshortname").val(""),e("#sxdescription").val(""),e("#sxvisible").data("kendoSwitch").value(!0)}),a.kendoWindow({width:"450px",title:M.util.get_string("createsubjectexam","local_newsvnr"),modal:!0,close:function(){d="subjectexam_add",n.fadeIn()},visible:!1,open:function(e){g(t,d),e.sender.center()}}),a.data("kendoWindow").close()}();var a={url:s,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",data:{action:"subjectexam_grid"}},r=[{field:"name",title:M.util.get_string("name","local_newsvnr"),width:"200px"},{field:"code",title:M.util.get_string("code","local_newsvnr"),width:"150px"},{field:"shortname",title:M.util.get_string("shortname","local_newsvnr"),width:"150px"},{field:"description",title:M.util.get_string("description","local_newsvnr"),width:"200px"},{template:function(e){return e.tempvisible},field:"tempvisible",title:M.util.get_string("examvisible","local_newsvnr"),width:"100px"}];t.columns=r,t.apiSettings=a,t.toolbar=[{template:'<a class="btn btn-secondary" id="btn-subjectexam-delete" href="javascript:;"><i class="fa fa-trash-o mr-2" aria-hidden="true"></i>'+M.util.get_string("deleteall","local_newsvnr")+"</a>"},"search"],t.editEvent=function(t){d="subjectexam_edit";var a=e("#form-subjectexam");1==t.visible?t.visible=!0:t.visible=!1,g(a,d),a.getKendoForm().setOptions({formData:{sxid:t.id,sxname:t.name,sxcode:t.code,sxshortname:t.shortname,sxdescription:t.description,sxvisible:t.visible}}),e("#modal-subjectexam").data("kendoWindow").open()},t.deleteEvent=function(t){var a={type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",data:{action:"subjectexam_delete",id:t.id}};e.ajax(s,a).then(function(t){t.success&&(e("#subjectexam-grid").data("kendoGrid").dataSource.read(),i.success(t.success,"success",3))})};var l=n.initGrid(t);e("#subjectexam-grid").kendoGrid(l),e("#btn-subjectexam-delete").click(function(){var t=m("#subjectexam-grid");if(t.length>0){var a={type:"POST",processData:!0,data:{action:"subjectexam_delete_all",rowselected:JSON.stringify(t)}};e.ajax(s,a).then(function(t){(t=JSON.parse(t)).success&&(e("#subjectexam-grid").data("kendoGrid").dataSource.read(),i.success(t.success,"success",3))})}else i.error(M.util.get_string("error_norowselectd","local_newsvnr"),"error",3)})},initExam:function(){var t={};b();var a={url:s,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",data:{action:"exam_grid"}},r=[{field:"name",title:M.util.get_string("name","local_newsvnr"),width:"200px"},{field:"code",title:M.util.get_string("code","local_newsvnr"),width:"150px"},{field:"type",title:M.util.get_string("type","local_newsvnr"),width:"100px"},{field:"datestart",title:M.util.get_string("examdatestart","local_newsvnr"),width:"200px"},{field:"dateend",title:M.util.get_string("examdateend","local_newsvnr"),width:"200px"},{field:"usercreate",title:M.util.get_string("usercreate","local_newsvnr"),width:"200px"},{field:"description",title:M.util.get_string("description","local_newsvnr"),width:"200px"},{template:function(e){return e.tempvisible},field:"tempvisible",title:M.util.get_string("examvisible","local_newsvnr"),width:"100px"}];t.columns=r,t.apiSettings=a,t.toolbar=[{template:'<a class="btn btn-secondary" id="btn-exam-delete" href="javascript:;"><i class="fa fa-trash-o mr-2" aria-hidden="true"></i>'+M.util.get_string("deleteall","local_newsvnr")+"</a>"},"search"],t.editEvent=function(t){var a=e("#form-exam");c="exam_edit",t.type==M.util.get_string("required","local_newsvnr")?t.type=0:t.type=1,1==t.visible?t.visible=!0:t.visible=!1,v(a,c);var n={type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",data:{action:"list_subjectexam_by_examid",examid:t.id}},i={examid:t.id,examname:t.name,examcode:t.code,examtype:t.type,examdatestart:new Date(t.datestart_raw),examdateend:new Date(t.dateend_raw),examdescription:t.description};a.getKendoForm().setOptions({formData:i}),e.ajax(s,n).then(function(e){i.subjectexam=e,i.examvisible=t.visible,a.getKendoForm().setOptions({formData:i})}),e("#modal-exam").data("kendoWindow").open()},t.enrollExamUsers=function(t){var a=e("#form-enrollexamusers"),n=e("#modal-enrollexamusers");w(t),n.kendoWindow({width:"1200px",height:"768px",title:M.util.get_string("enrollexamuser","local_newsvnr"),modal:!0,open:function(e){a.getKendoForm()&&(a.getKendoForm().destroy(),a.empty()),f(a,t),e.sender.center()},close:function(){n.fadeIn()}}),n.data("kendoWindow").open()},t.deleteEvent=function(t){i.confirm(M.util.get_string("confirm_datadelete","local_newsvnr"),M.util.get_string("warning_examdelete","local_newsvnr"),function(){var a={type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",data:{action:"exam_delete",id:t.id}};e.ajax(s,a).then(function(t){t.success&&(e("#exam-grid").data("kendoGrid").dataSource.read(),i.success(t.success,"success",3))})},function(){}).set("labels",{ok:M.util.get_string("accept","local_newsvnr"),cancel:M.util.get_string("cancel","local_newsvnr")})};var l=n.initGrid(t);e("#exam-grid").kendoGrid(l),e("#btn-exam-delete").click(function(){var t=m("#exam-grid");t.length>0?i.confirm(M.util.get_string("confirm_datadelete","local_newsvnr"),M.util.get_string("warning_examdelete","local_newsvnr"),function(){var a={type:"POST",processData:!0,data:{action:"exam_delete_all",rowselected:JSON.stringify(t)}};e.ajax(s,a).then(function(t){(t=JSON.parse(t)).success&&(e("#exam-grid").data("kendoGrid").dataSource.read(),i.success(t.success,"success",3))})},function(){}).set("labels",{ok:M.util.get_string("accept","local_newsvnr"),cancel:M.util.get_string("cancel","local_newsvnr")}):i.error(M.util.get_string("error_norowselectd","local_newsvnr"),"error",3)})},initViewExam:function(){e("#btn-exam").click(function(t){t.preventDefault(),b(),e("#modal-exam").data("kendoWindow").open()}),e("#exam-type").kendoDropDownList({dataSource:[{text:M.util.get_string("listexamrequired","local_newsvnr"),value:0},{text:M.util.get_string("listexamfree","local_newsvnr"),value:1}],dataTextField:"text",dataValueField:"value",change:function(t){var a={type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",data:{action:"exam_category",examtype:this.value()}};l.ui.progress(e("#menu-tree-exam"),!0),e.ajax(o,a).then(function(t){t.category?(e("#exam-category").empty(),e("#exam-category").html(t.category)):e("#exam-category").html('<div class="alert-danger d-flex justify-content-center p-2">'+t.nocategory+"!</div>"),l.ui.progress(e("#menu-tree-exam"),!1)})}});var t={type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",data:{action:"exam_category",examtype:e("#exam-type").data("kendoDropDownList").value()}};l.ui.progress(e("#menu-tree-exam"),!0),e.ajax(o,t).then(function(t){t.category?(e("#exam-category").empty(),e("#exam-category").html(t.category)):e("#exam-category").html('<div class="alert-danger d-flex justify-content-center p-2">'+t.nocategory+"!</div>"),l.ui.progress(e("#menu-tree-exam"),!1)}),e("#exam-category").on("click","li",function(t){e(this).addClass("active").siblings().removeClass("active");var a=e(this).attr("data-exam"),r={type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",data:{action:"exam_description",examid:a}};if(e.ajax(o,r).then(function(t){e("#ed-name").val(t.examdescription.name),e("#ed-code").val(t.examdescription.code),e("#ed-type").val(t.examdescription.type),e("#ed-datestart").val(t.examdescription.datestart),e("#ed-dateend").val(t.examdescription.dateend),e("#ed-description").val(t.examdescription.description),e("#ed-teacher").html(t.examdescription.teacher),e("#ed-numnberstudent").html(t.examdescription.numberstudent)}),function(t){var a={},i={url:o,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",data:{action:"exam_listsubjectexam_grid",examid:t}},r=[{field:"name",title:M.util.get_string("name","local_newsvnr"),width:"200px"},{field:"numberquiz",title:M.util.get_string("numberquiz","local_newsvnr"),width:"200px"}];a.columns=r,a.apiSettings=i,a.listSubjectExamDetailEvent=function(t){var a=e("#modal-listsubjectexam"),n={type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",data:{action:"exam_listsubjectexam_detail",subjectexamid:t.subjectexamid}};a.kendoWindow({width:"450px",title:M.util.get_string("listsubjectexam","local_newsvnr"),modal:!0,open:function(t){l.ui.progress(e("#modal-listsubjectexam"),!0),e.ajax(o,n).then(function(t){a.data("kendoWindow").content(t.success),l.ui.progress(e("#modal-listsubjectexam"),!1)}),t.sender.center()}}),a.data("kendoWindow").open()};var s=n.initGrid(a);e("#exam-list-grid").data("kendoGrid")&&e("#exam-list-grid").data("kendoGrid").destroy(),e("#exam-list-grid").kendoGrid(s)}(a),h(a),null!=a){var s={url:o,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",data:{action:"exam_listsubjectexam",examid:a}};e("#list-subjectexam").data("kendoDropDownList")&&e("#list-subjectexam").data("kendoDropDownList").destroy(),e("#list-subjectexam").kendoDropDownList({dataSource:p(s),dataTextField:"name",dataValueField:"id",placeholder:M.util.get_string("selectsubjectexam","local_newsvnr"),filter:"contains",change:function(t){var n=this.value();if(e("#exam-result-grid").data("kendoGrid")&&e("#exam-result-grid").data("kendoGrid").destroy(),n<0)return i.error(M.util.get_string("requiredselectsubjectexam","local_newsvnr"),"error",3),!0;var r={url:o,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",data:{action:"exam_userresult_grid",examid:a,subjectid:n}};l.ui.progress(e("#exam-result-grid"),!0),e.ajax(o,r).then(function(t){if(!t.data_columns)return e("#exam-result-grid").css("height","25px"),e("#exam-result-grid").html('<div class="alert-danger d-flex justify-content-center p-2">'+M.util.get_string("noquizforsubjectexam","local_newsvnr")+"!</div>"),!1;e("#exam-result-grid").empty(),t.data_columns.forEach(function(e){var t;e.template&&(e.template=(t=e.template,Function('"use strict";return ('+t+")")()))});var a=new l.data.DataSource({transport:{read:r,parameterMap:function(e,t){if("read"==t)return e.filter&&(e.q=e.filter.filters[0].value),e}},pageSize:10,serverPaging:!0,serverFiltering:!0,serverSorting:!0,schema:{model:{id:"id",fields:{id:{type:"number"},name:{type:"string"}}},data:"data_grid"}});l.ui.progress(e("#exam-result-grid"),!1),e("#exam-result-grid").kendoGrid({dataSource:a,persistSelection:!0,groupable:!1,resizable:!0,toolbar:["search"],search:{fields:["name"]},pageable:{refresh:!0,pageSizes:!0,pageSizes:[10,20,50,100],buttonCount:5},height:450,columns:t.data_columns,noRecords:{template:'<span class="grid-empty">'+M.util.get_string("emptydata","local_newsvnr")+"</span>"}})})}})}});var a=e("#exam-category li.active").attr("data-exam");h(a),e("#btn-enrollexamusers").click(function(){var t=e("#form-enrollexamusers"),a=e("#modal-enrollexamusers"),n={};n.id=e("#exam-category li.active").attr("data-exam"),w(n),a.kendoWindow({width:"1368px",height:"768px",title:M.util.get_string("enrollexamuser","local_newsvnr"),modal:!0,open:function(e){t.getKendoForm()&&(t.getKendoForm().destroy(),t.empty()),f(t,n),e.sender.center()}}),a.data("kendoWindow").open()})}}});